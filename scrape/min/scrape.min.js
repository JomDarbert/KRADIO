var CronJob,cheerio,fs,get_data,out_file,pages,request,songs;request=require("request"),cheerio=require("cheerio"),fs=require("fs"),CronJob=require("cron").CronJob,songs=[],out_file="songs.json",pages=["http://www.eatyourkimchi.com/kpopcharts/","http://www.eatyourkimchi.com/kpopcharts/page/2/","http://www.eatyourkimchi.com/kpopcharts/page/3/","http://www.eatyourkimchi.com/kpopcharts/page/4/","http://www.eatyourkimchi.com/kpopcharts/page/5/","http://www.eatyourkimchi.com/kpopcharts/page/6/","http://www.eatyourkimchi.com/kpopcharts/page/7/","http://www.eatyourkimchi.com/kpopcharts/page/8/","http://www.eatyourkimchi.com/kpopcharts/page/9/","http://www.eatyourkimchi.com/kpopcharts/page/10/","http://mwave.interest.me/kpop/chart.m"],get_data=function(t,e){var o,r,a,i,s;for(s=[],a=0,i=t.length;i>a;a++)r=t[a],o=0,s.push(request(r,function(t,e,o){var r,a;t||200!==e.statusCode||(r=cheerio.load(o),a=[],r("h2.bkp-toggle-vid").each(function(){var t,e,o,i,s;e=r(this).text().replace("(","").replace(")","").replace("'","").split(" â€“ "),t=e[0],s=e[1],i=t+" "+s,o={artist:t,title:s,query:i.toLowerCase()},a.push(o)}),r("div.song_artist").each(function(){var t,e,o,i;t=r(this).find(".tit_artist a:first-child").text().replace("(","").replace(")","").replace("'",""),i=r(this).find(".tit_song a").text().replace("(","").replace(")","").replace("'",""),o=t+" "+i,e={artist:t,title:i,query:o.toLowerCase()},a.push(e)}),songs.push(a))}).on("end",function(){var t;return o++,o===pages.length?(t=[],t=t.concat.apply(t,songs),e(t)):void 0}));return s},new CronJob("0 0,12 * * *",function(){songs=[],get_data(pages,function(t){var e;return e=fs.existsSync(out_file),e===!0&&fs.unlink(out_file,function(t){if(t)throw t;console.log("Successfully deleted "+out_file)}),fs.writeFile(out_file,JSON.stringify(t),function(t){if(t)throw t;console.log("JSON saved to "+out_file)})})},null,!0);
