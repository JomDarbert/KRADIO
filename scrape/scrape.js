var CronJob,cheerio,fs,get_data,out_file,pages,request,songs;request=require("request"),cheerio=require("cheerio"),fs=require("fs"),CronJob=require("cron").CronJob,songs=[],out_file="songs.json",pages=["http://www.eatyourkimchi.com/kpopcharts/","http://www.eatyourkimchi.com/kpopcharts/page/2/","http://www.eatyourkimchi.com/kpopcharts/page/3/","http://www.eatyourkimchi.com/kpopcharts/page/4/","http://www.eatyourkimchi.com/kpopcharts/page/5/","http://www.eatyourkimchi.com/kpopcharts/page/6/","http://www.eatyourkimchi.com/kpopcharts/page/7/","http://www.eatyourkimchi.com/kpopcharts/page/8/","http://www.eatyourkimchi.com/kpopcharts/page/9/","http://www.eatyourkimchi.com/kpopcharts/page/10/","http://mwave.interest.me/kpop/chart.m"],get_data=function(urls,callback){var count,page,_i,_len,_results;for(_results=[],_i=0,_len=urls.length;_len>_i;_i++)page=urls[_i],count=0,_results.push(request(page,function(error,response,html){var $,parsedResults;error||200!==response.statusCode||($=cheerio.load(html),parsedResults=[],$("h2.bkp-toggle-vid").each(function(){var artist,content,eyk,query,title;content=$(this).text().replace("(","").replace(")","").replace("'","").split(" â€“ "),artist=content[0],title=content[1],query=artist+" "+title,eyk={artist:artist,title:title,query:query.toLowerCase()},parsedResults.push(eyk)}),$("div.song_artist").each(function(){var artist,mwave,query,title;artist=$(this).find(".tit_artist a:first-child").text().replace("(","").replace(")","").replace("'",""),title=$(this).find(".tit_song a").text().replace("(","").replace(")","").replace("'",""),query=artist+" "+title,mwave={artist:artist,title:title,query:query.toLowerCase()},parsedResults.push(mwave)}),songs.push(parsedResults))}).on("end",function(){var merged;return count++,count===pages.length?(merged=[],merged=merged.concat.apply(merged,songs),callback(merged)):void 0}));return _results},new CronJob("0 0,12 * * *",function(){songs=[],get_data(pages,function(data){var exists;return exists=fs.existsSync(out_file),exists===!0&&fs.unlink(out_file,function(err){if(err)throw err;console.log("Successfully deleted "+out_file)}),fs.writeFile(out_file,JSON.stringify(data),function(err){if(err)throw err;console.log("JSON saved to "+out_file)})})},null,!0);