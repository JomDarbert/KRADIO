var CronJob,cheerio,fs,get_data,out_file,pages,request,songs;request=require("request"),cheerio=require("cheerio"),fs=require("fs"),CronJob=require("cron").CronJob,songs=[],out_file="songs.json",pages=["http://www.eatyourkimchi.com/kpopcharts/","http://www.eatyourkimchi.com/kpopcharts/page/2/","http://www.eatyourkimchi.com/kpopcharts/page/3/","http://www.eatyourkimchi.com/kpopcharts/page/4/","http://www.eatyourkimchi.com/kpopcharts/page/5/","http://www.eatyourkimchi.com/kpopcharts/page/6/","http://www.eatyourkimchi.com/kpopcharts/page/7/","http://www.eatyourkimchi.com/kpopcharts/page/8/","http://www.eatyourkimchi.com/kpopcharts/page/9/","http://www.eatyourkimchi.com/kpopcharts/page/10/","http://mwave.interest.me/kpop/chart.m"],get_data=function(t,e){var o,r,i,a,c;for(c=[],i=0,a=t.length;a>i;i++)r=t[i],o=0,c.push(request(r,function(t,e,o){var r,i;t||200!==e.statusCode||(r=cheerio.load(o),i=[],r("h2.bkp-toggle-vid").each(function(){var t,e,o,a,c;e=r(this).text().replace("(","").replace(")","").replace("'","").split(" â€“ "),t=e[0],c=e[1],a=t+" "+c,o={artist:t,title:c,query:a.toLowerCase()},i.push(o)}),r("div.song_artist").each(function(){var t,e,o,a;t=r(this).find(".tit_artist a:first-child").text().replace("(","").replace(")","").replace("'",""),a=r(this).find(".tit_song a").text().replace("(","").replace(")","").replace("'",""),o=t+" "+a,e={artist:t,title:a,query:o.toLowerCase()},i.push(e)}),songs.push(i))}).on("end",function(){var t;return o++,o===pages.length?(t=[],t=t.concat.apply(t,songs),e(t)):void 0}));return c},new CronJob("0 0,12 * * *",function(){songs=[],get_data(pages,function(t){var e;return e=fs.existsSync(out_file),e===!0&&fs.unlink(out_file,function(t){if(t)throw t;console.log("Successfully deleted "+out_file)}),fs.writeFile(out_file,JSON.stringify(t),function(t){if(t)throw t;console.log("JSON saved to "+out_file)})})},null,!0);