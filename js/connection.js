(function(){var addToHistory,blacklist,checkBlacklist,checkWhitelist,choosePlayer,client_id,has_korean,history,import_songs,loadSong,notAvailable,not_kor_eng,player_one,player_three,player_two,processSong,queryLimit,randomQuery,song,top_queries,whitelist,_i,_len,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};for(client_id="2721807f620a4047d473472d46865f14",SC.initialize({client_id:client_id}),queryLimit=100,whitelist=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],blacklist=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat"],not_kor_eng=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,has_korean=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,history=[],notAvailable=[],player_one=document.getElementById("player_one"),player_two=document.getElementById("player_two"),player_three=document.getElementById("player_three"),import_songs=function(){var json;return json=null,$.ajax({async:!1,global:!1,url:"../scrape/songs.json",dataType:"json",success:function(data){json=data}}),json}(),top_queries=[],_i=0,_len=import_songs.length;_len>_i;_i++)song=import_songs[_i],top_queries.push(song.query);top_queries=arrayUnique(top_queries),checkBlacklist=function(song,query){var arrays,cleaned_query,cleaned_song,created_date,date_limit,kor_eng_test,ok_months,query_array,result,song_array,term,_j,_k,_l,_len1,_len2,_len3;if(null==song.title)return!1;if(null==song.url)return!1;if(null==song.created)return!1;if(ok_months=12,created_date=moment(song.created,"YYYY-MM-DD HH:MM:SS"),date_limit=moment().subtract(ok_months,"months"),date_limit.diff(created_date,"months")>0)return!1;for(_j=0,_len1=blacklist.length;_len1>_j;_j++)if(term=blacklist[_j],-1!==song.title.indexOf(term))return!1;for(_k=0,_len2=blacklist.length;_len2>_k;_k++)if(term=blacklist[_k],null!=song.genre&&-1!==song.genre.indexOf(term))return!1;for(_l=0,_len3=blacklist.length;_len3>_l;_l++)if(term=blacklist[_l],__indexOf.call(song.tags,term)>=0)return!1;return kor_eng_test=not_kor_eng.test(song.title),kor_eng_test===!0?!1:(cleaned_song=song.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),cleaned_query=query.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),song_array=cleaned_song.split(" "),query_array=cleaned_query.split(" "),arrays=[song_array,query_array],result=arrays.shift().reduce(function(res,v){return-1===res.indexOf(v)&&arrays.every(function(a){return-1!==a.indexOf(v)})&&res.push(v),res},[]),0===result.length?!1:!0)},checkWhitelist=function(song,query){var arrays,cleaned_query,cleaned_song,query_array,query_count,result,score,song_array,tags_count,term,test,_j,_len1,_ref;for(score=0,tags_count=0,query_count=0,cleaned_song=song.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),cleaned_query=query.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),_ref=song.genre,__indexOf.call(whitelist,_ref)>=0&&(score+=1),_j=0,_len1=whitelist.length;_len1>_j;_j++)term=whitelist[_j],__indexOf.call(song.tags,term)>=0&&(tags_count+=1);return tags_count>0&&(score+=1),test=has_korean.test(song.title),test===!0&&(score+=1),song_array=cleaned_song.split(" "),query_array=cleaned_query.split(" "),arrays=[song_array,query_array],result=arrays.shift().reduce(function(res,v){return-1===res.indexOf(v)&&arrays.every(function(a){return-1!==a.indexOf(v)})&&res.push(v),res},[]),result.length===query_array.length&&(score+=1),levenstein(cleaned_query,cleaned_song)<=10&&(score+=1),score},loadSong=function(query){var dfd;return dfd=$.Deferred(),console.log("Starting get at: "+new Date),SC.get("/tracks",{q:query,limit:queryLimit},function(tracks){var acceptable;return console.log("Got tracks at: "+new Date),null==tracks||0===tracks.length?(dfd.reject(),void 0):(acceptable=[],tracks.forEach(function(t){var artwork,blacklist_pass,created,duration,genre,tags,title,url,views;return null!=t.title&&(title=t.title.toLowerCase()),null!=t.genre&&(genre=t.genre.toLowerCase()),null!=t.tag_list&&(tags=t.tag_list.toLowerCase().split(" ")),null!=t.created_at&&(created=t.created_at),null!=t.stream_url&&(url=t.stream_url+"?client_id="+client_id),null!=t.artwork_url&&(artwork=t.artwork_url.replace("-large","-t500x500")),null!=t.playback_count&&(views=t.playback_count),null!=t.duration&&(duration=t.duration/1e3),song={title:title,genre:genre,tags:tags,created:created,url:url,artwork:artwork,duration:duration,views:views,score:0,query:query},blacklist_pass=checkBlacklist(song,query),song.score=checkWhitelist(song,query),blacklist_pass===!0&&song.score>=2?acceptable.push(song):void 0}),acceptable.sort(function(x,y){var n;return n=y.score-x.score,0!==n?n:y.views-x.views}),acceptable.length>0?dfd.resolve(acceptable[0]):dfd.reject(),void 0)}),dfd.promise()},addToHistory=function(song){var len,max;len=history.length,max=9,null!=song.query&&history.unshift(song.query),len>max&&history.splice(max+1,len-max)},randomQuery=function(){var availableSongs;return availableSongs=top_queries.filter(function(x){return history.indexOf(x)<0}),availableSongs=availableSongs.filter(function(y){return notAvailable.indexOf(y)<0}),availableSongs[Math.floor(Math.random()*availableSongs.length)]},processSong=function(query){var dfd,request;return request=function(query){return loadSong(query).done(function(song){return addToHistory(song),dfd.resolve(song)}).fail(function(){var newQ;return notAvailable.push(query),newQ=randomQuery(),request(newQ)})},dfd=$.Deferred(),request(query),dfd.promise()},choosePlayer=function(){var a,c,len,n,o,players,seq;return players=[player_one,player_two,player_three],c=players.indexOf(document.getElementsByClassName("active")[0]),len=players.length-1,a=null==c||c===len?0:c+1,n=a===len?0:a+1,o=n===len?0:n+1,seq={active:players[a],next:players[n],onDeck:players[o],last:players[c]},seq.active.classList.add("active"),seq.next.classList.remove("active"),seq.onDeck.classList.remove("active"),seq},$("#nextButton").on("click",function(){var players,query;return players=choosePlayer(),query=randomQuery(),players.last.pause(),players.active.play(),processSong(query).done(function(result){return console.log("Got "+result.title+" at: "+new Date),players.last.setAttribute("src",result.url)})}),$("#playButton").on("click",function(){var p;return p=document.getElementsByClassName("active")[0],p.paused?p.play():p.pause()}),$(document).ready(function(){var q_one,q_three,q_two;return q_one=randomQuery(),q_two=randomQuery(),q_three=randomQuery(),processSong(q_one).done(function(res_one){return player_one.setAttribute("src",res_one.url)}),processSong(q_two).done(function(res_two){return player_two.setAttribute("src",res_two.url)}),processSong(q_three).done(function(res_three){return player_three.setAttribute("src",res_three.url)})})}).call(this);