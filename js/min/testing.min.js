(function(){var e,r,t,n,o,l,i,a,u,s,c,f,g,d,p,v,h,m,k,w,y,x,_,A,F=[].indexOf||function(e){for(var r=0,t=this.length;t>r;r++)if(r in this&&this[r]===e)return r;return-1};for(o="2721807f620a4047d473472d46865f14",SC.initialize({client_id:o}),p=100,w=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],r=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat"],g=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,a=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,u=[],f=[],k=null,l=!1,i=function(){var e;return e=null,$.ajax({async:!1,global:!1,url:"../scrape/EYK/tutorial/eyk.json",dataType:"json",success:function(r){e=r}}),e}(),c=function(){var e;return e=null,$.ajax({async:!1,global:!1,url:"../scrape/MWAVE/tutorial/mwave.json",dataType:"json",success:function(r){e=r}}),e}(),m=[],y=0,_=i.length;_>y;y++)h=i[y],h=h.title,h=h.toLowerCase(),m.push(h);for(x=0,A=c.length;A>x;x++)h=c[x],h=h.artist+" "+h.title,h=h.toLowerCase(),m.push(h);m=arrayUnique(m),t=function(e,t){var n,o,l,i,a,u,s,c,f,d,p,v,h,m,k,w,y;if(null==e.title)return!1;if(null==e.url)return!1;if(null==e.created)return!1;if(s=12,i=moment(e.created,"YYYY-MM-DD HH:MM:SS"),a=moment().subtract(s,"months"),a.diff(i,"months")>0)return!1;for(v=0,m=r.length;m>v;v++)if(p=r[v],-1!==e.title.indexOf(p))return!1;for(h=0,k=r.length;k>h;h++)if(p=r[h],null!=e.genre&&-1!==e.genre.indexOf(p))return!1;for(y=0,w=r.length;w>y;y++)if(p=r[y],F.call(e.tags,p)>=0)return!1;return u=g.test(e.title),u===!0?!1:(l=e.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),o=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),d=l.split(" "),c=o.split(" "),n=[d,c],f=n.shift().reduce(function(e,r){return-1===e.indexOf(r)&&n.every(function(e){return-1!==e.indexOf(r)})&&e.push(r),e},[]),0===f.length?!1:!0)},n=function(e,r){var t,n,o,l,i,u,s,c,f,g,d,p,v,h;for(s=0,f=0,i=0,o=e.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),n=r.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),h=e.genre,F.call(w,h)>=0&&(s+=1),p=0,v=w.length;v>p;p++)g=w[p],F.call(e.tags,g)>=0&&(f+=1);return f>0&&(s+=1),d=a.test(e.title),d===!0&&(s+=1),c=o.split(" "),l=n.split(" "),t=[c,l],u=t.shift().reduce(function(e,r){return-1===e.indexOf(r)&&t.every(function(e){return-1!==e.indexOf(r)})&&e.push(r),e},[]),u.length===l.length&&(s+=1),levenstein(n,o)<=10&&(s+=1),s},s=function(e){var r;return r=$.Deferred(),console.log("waiting for get..."),SC.get("/tracks",{q:e,limit:p},function(l){var i;return null==l||0===l.length?(r.resolve(!1),void 0):(i=[],l.forEach(function(r){var l,a,u,s,c,f,g,d,p;return null!=r.title&&(g=r.title.toLowerCase()),null!=r.genre&&(c=r.genre.toLowerCase()),null!=r.tag_list&&(f=r.tag_list.toLowerCase().split(" ")),null!=r.created_at&&(u=r.created_at),null!=r.stream_url&&(d=r.stream_url+"?client_id="+o),null!=r.artwork_url&&(l=r.artwork_url.replace("-large","-t500x500")),null!=r.playback_count&&(p=r.playback_count),null!=r.duration&&(s=r.duration/1e3),h={title:g,genre:c,tags:f,created:u,url:d,artwork:l,duration:s,views:p,score:0,query:e},a=t(h,e),h.score=n(h,e),a===!0&&h.score>=2?i.push(h):void 0}),i.sort(function(e,r){var t;return t=r.score-e.score,0!==t?t:r.views-e.views}),i.length>0?r.resolve(i[0]):r.resolve(!1),void 0)}),r.promise()},e=function(e){var r,t;r=u.length,t=9,null!=e.query&&u.unshift(e.query),r>t&&u.splice(t+1,r-t),console.log("done adding to history")},v=function(){var e;return e=m.filter(function(e){return u.indexOf(e)<0}),e=e.filter(function(e){return f.indexOf(e)<0}),console.log("done random query"),e[Math.floor(Math.random()*e.length)]},d=function(r){var t;return t=$.Deferred(),s(r).done(function(n){console.log("loaded: "+n.title),n!==!1?(e(n),k=v(),console.log(k),t.resolve(n)):(console.log("error: "+r),f.push(r),l=!0,k=v(),t.resolve(!1))}),t.promise()},$("#test").on("click",function(){var e;return e=null!=k?k:v(),console.log(f),d(e).done(function(r){var t;return console.log("result 1: "+r),$("#player_one").attr("src",r.url),t=document.getElementById("player_one"),t.play(),r===!1?(e=v(),d(e).done(function(r){return console.log("result 2: "+r),r===!1?(e=v(),d(e).done(function(e){return console.log("result 3: "+e)})):void 0})):void 0})})}).call(this);