(function(){var e,t,n,r,a,u,i,o,l,c,s,d,f,g,h,m,v,p,y,k,x,A,b,w,_,D,F,B,C,M,O,E,S,L,T=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};for(i="2721807f620a4047d473472d46865f14",SC.initialize({client_id:i}),F=100,E=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],n=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat","short","club"],v=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,d=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,p=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,f=[],m=[],c=function(e){var t,n;return t=new RegExp(e+"=([^;]+)"),n=t.exec(document.cookie),null!=n?unescape(n[1]):null},o=c("dontPlay"),l=null!==o?JSON.parse(o):[],A=document.getElementById("player_one"),w=document.getElementById("player_two"),b=document.getElementById("player_three"),x=document.getElementById("player_four"),k=document.getElementById("player_five"),_=[A,w,b,x,k],s=function(){var e;return e=null,e=new XMLHttpRequest,e.open("GET","http://jombly.com:3000/today",!1),e.send(null),e.responseText},M=JSON.parse(s()),O=arrayUnique(M),Number.prototype.toHHMMSS=function(){var e,t,n;return e=Math.floor(this/3600),t=Math.floor(this%3600/60),n=Math.floor(this%3600%60),(e>0?e+":":"")+(t>0?(e>0&&10>t?"0":"")+t+":":"0:")+(10>n?"0":"")+n},e=function(e,t){jQuery.ajax({url:e,dataType:"text",type:"GET",complete:function(e){"function"==typeof t&&t.apply(this,[e.status])}})},r=function(e,t){var r,a,u,i,o,l,c,s,d,f,g,h,m,p,y,k,x;if(null==e.title)return!1;if(null==e.url)return!1;if(null==e.created)return!1;if(c=12,i=moment(e.created,"YYYY-MM-DD HH:MM:SS"),o=moment().subtract(c,"months"),o.diff(i,"months")>0)return!1;if(e.duration>360)return!1;for(h=0,y=n.length;y>h;h++)if(g=n[h],-1!==e.title.indexOf(g))return!1;for(m=0,k=n.length;k>m;m++)if(g=n[m],null!=e.genre&&-1!==e.genre.indexOf(g))return!1;for(p=0,x=n.length;x>p;p++)if(g=n[p],T.call(e.tags,g)>=0)return!1;return l=v.test(e.title),l===!0?!1:(u=e.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),a=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),f=u.split(" "),s=a.split(" "),r=[f,s],d=r.shift().reduce(function(e,t){return-1===e.indexOf(t)&&r.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),0===d.length?!1:!0)},a=function(e,t){var n,r,a,u,i,o,l,c,s,f,g,h,m,v;for(l=0,s=0,i=0,a=e.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),v=e.genre,T.call(E,v)>=0&&(l+=1),h=0,m=E.length;m>h;h++)f=E[h],T.call(e.tags,f)>=0&&(s+=1);return s>0&&(l+=1),g=d.test(e.title),g===!0&&(l+=1),c=a.split(" "),u=r.split(" "),n=[c,u],o=n.shift().reduce(function(e,t){return-1===e.indexOf(t)&&n.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),o.length===u.length&&(l+=1),levenstein(r,a)<=10&&(l+=1),l},g=function(e){var t;return t=$.Deferred(),SC.get("/tracks",{q:e.query,limit:F},function(n,u){var o;return null==n||0===n.length||null!==u?void t.reject():(o=[],n.forEach(function(t){var n,u,l,c,s,f,g,h,m,v,y;return m=d.test(t.title),f=null!=t.title&&m===!0?"("+t.title.toLowerCase().replace(p,"")+")":"",null!=t.genre&&(s=t.genre.toLowerCase()),null!=t.tag_list&&(h=t.tag_list.toLowerCase().split(" ")),null!=t.created_at&&(l=t.created_at),null!=t.stream_url&&(v=t.stream_url+"?client_id="+i),null!=t.artwork_url&&(n=t.artwork_url.replace("-large","-t500x500")),null!=t.playback_count&&(y=t.playback_count),null!=t.duration&&(c=t.duration/1e3),g={title:""+e.artist+"  —  "+e.title+" "+f,song:e.title,artist:e.artist,rank:e.rank,num_days:e.num_days,change:e.change,korean:f,genre:s,tags:h,created:l,url:v,artwork:n,duration:c,views:y,score:0,query:e.query},u=r(g,e.query),g.score=a(g,e.query),u===!0&&g.score>=3?o.push(g):void 0}),o.sort(function(e,t){return t.views-e.views}),o.length>0?t.resolve(o[0]):t.reject(),void 0)}),t.promise()},t=function(e){var t,n;t=f.length,n=9,null!=e.query&&f.unshift(e.query),t>n&&f.splice(n+1,t-n)},B=function(){var e;return e=O.filter(function(e){return f.indexOf(e)<0}),e=e.filter(function(e){return m.indexOf(e)<0}),e=e.filter(function(e){return l.indexOf(e)<0}),e[Math.floor(Math.random()*e.length)]},D=function(e){var n,r;return r=function(e){return g(e).done(function(e){return t(e),n.resolve(e)}).fail(function(){var t;return m.push(e),t=B(),r(t)})},n=$.Deferred(),r(e),n.promise()},u=function(){var e,t,n,r,a,u,i,o;return _=[A,w,b,x,k],t=_.indexOf(document.getElementsByClassName("active")[0]),n=_.length-1,e=null==t||t===n?0:t+1,r=e===n?0:e+1,a=r===n?0:r+1,i=a===n?0:a+1,u=i===n?0:i+1,o={active:_[e],next:_[r],onDeck:_[a],onDeckTwo:_[i],onDeckThree:_[u],last:_[t]},o.active.classList.add("active"),o.next.classList.remove("active"),o.onDeck.classList.remove("active"),o.onDeckTwo.classList.remove("active"),o.onDeckThree.classList.remove("active"),o},C=function(e,t){return e.setAttribute("src",t.url),e.setAttribute("artwork",t.artwork),e.setAttribute("songtitle",t.title),e.setAttribute("songlength",t.duration),e.setAttribute("rank",t.rank),e.setAttribute("change",t.change),e.setAttribute("num_days",t.num_days),e.setAttribute("query",t.query)},h=function(){var t,n,r,a,i,o,l,c,s;_=u(),o=B(),r=Number(_.active.getAttribute("songlength")).toHHMMSS(),t=_.active.getAttribute("artwork"),c=_.active.getAttribute("songtitle"),a=_.active.getAttribute("songlength"),s=_.active.getAttribute("src"),l=_.active.getAttribute("rank"),n=_.active.getAttribute("change"),i=_.active.getAttribute("num_days"),e(s,function(e){(404===e||503===e)&&h()}),e(t,function(e){(404===e||503===e)&&h()}),_.last.pause(),_.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=a&&void 0!==a&&$("#seek").attr("max",a),null!=c&&void 0!==c&&$("#title").text(c),null!=t&&void 0!==t&&$("#container").css("background","url("+t+") no-repeat center center"),$("#title").text(c),$("#rank").text("Rank "+l),0>n&&($("#change").css("color","#D7431B"),$("#change").text("( "+n+" )")),n>0&&($("#change").css("color","#288668"),$("#change").text("( +"+n+" )")),0===n&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+i+" days on chart"),D(o).done(function(e){return C(_.last,e)})},document.addEventListener("touchmove",function(e){return e.preventDefault()}),$("#nextButton").on("click",function(){return h()}),$("#playButton").on("click",function(){var e;return e=document.getElementsByClassName("active")[0],e.paused?($("#playButton").html("&#xf04c;"),e.play()):($("#playButton").html("&#xf04b;"),e.pause())}),S=0,L=_.length;L>S;S++)y=_[S],y.onplaying=function(){return $("#playButton").html("&#xf04c;")},y.onended=function(){return h()},y.ontimeupdate=function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)};$("#seek").on("input",function(){var e;return e=document.getElementsByClassName("active")[0],e.pause(),e.currentTime=this.value}),$("#seek").on("change",function(){var e;return e=document.getElementsByClassName("active")[0],e.play()}),$("#dontPlay").on("click",function(){var e,t;return e=document.getElementsByClassName("active")[0],t=e.getAttribute("query"),l.push(t),document.cookie="dontPlay="+JSON.stringify(l),h()}),$(document).ready(function(){var e,t,n,r,a;return n=B(),a=B(),r=B(),t=B(),e=B(),D(n).done(function(e){return C(A,e),null!=e.duration&&($("#endTime").val(e.duration.toHHMMSS()),$("#seek").attr("max",e.duration)),null!=e.artwork&&$("#container").css("background","url("+e.artwork+") no-repeat center center"),$("#title").text(e.title),$("#rank").text("Rank "+e.rank),e.change<0&&($("#change").css("color","#D7431B"),$("#change").text("( "+e.change+" )")),e.change>0&&($("#change").css("color","#288668"),$("#change").text("( +"+e.change+" )")),0===e.change&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+e.num_days+" days on chart")}),D(a).done(function(e){return C(w,e)}),D(r).done(function(e){return C(b,e)}),D(t).done(function(e){return C(x,e)}),D(e).done(function(e){return C(k,e)})})}).call(this);
