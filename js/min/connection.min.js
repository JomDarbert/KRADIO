(function(){var t,e,r,n,u,i,a,o,l,s,c,f,d,g,v,p,m,h,k,y,A,b,x,w,F,_,C,D=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};for(a="2721807f620a4047d473472d46865f14",SC.initialize({client_id:a}),b=100,F=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],r=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat"],g=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,o=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,v=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,l=[],d=[],m=document.getElementById("player_one"),k=document.getElementById("player_two"),h=document.getElementById("player_three"),y=[m,k,h],s=function(){var t;return t=null,$.ajax({async:!1,global:!1,url:"../scrape/songs.json",dataType:"json",success:function(e){t=e}}),t}(),w=arrayUnique(s[0].data),Number.prototype.toHHMMSS=function(){var t,e,r;return t=Math.floor(this/3600),e=Math.floor(this%3600/60),r=Math.floor(this%3600%60),(t>0?t+":":"")+(e>0?(t>0&&10>e?"0":"")+e+":":"0:")+(10>r?"0":"")+r},t=function(t,e){jQuery.ajax({url:t,dataType:"text",type:"GET",complete:function(t){"function"==typeof e&&e.apply(this,[t.status])}})},n=function(t,e){var n,u,i,a,o,l,s,c,f,d,v,p,m,h,k,y,A;if(null==t.title)return!1;if(null==t.url)return!1;if(null==t.created)return!1;if(s=12,a=moment(t.created,"YYYY-MM-DD HH:MM:SS"),o=moment().subtract(s,"months"),o.diff(a,"months")>0)return!1;for(p=0,k=r.length;k>p;p++)if(v=r[p],-1!==t.title.indexOf(v))return!1;for(m=0,y=r.length;y>m;m++)if(v=r[m],null!=t.genre&&-1!==t.genre.indexOf(v))return!1;for(h=0,A=r.length;A>h;h++)if(v=r[h],D.call(t.tags,v)>=0)return!1;return l=g.test(t.title),l===!0?!1:(i=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),u=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),d=i.split(" "),c=u.split(" "),n=[d,c],f=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),0===f.length?!1:!0)},u=function(t,e){var r,n,u,i,a,l,s,c,f,d,g,v,p,m;for(s=0,f=0,a=0,u=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),n=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),m=t.genre,D.call(F,m)>=0&&(s+=1),v=0,p=F.length;p>v;v++)d=F[v],D.call(t.tags,d)>=0&&(f+=1);return f>0&&(s+=1),g=o.test(t.title),g===!0&&(s+=1),c=u.split(" "),i=n.split(" "),r=[c,i],l=r.shift().reduce(function(t,e){return-1===t.indexOf(e)&&r.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),l.length===i.length&&(s+=1),levenstein(n,u)<=10&&(s+=1),s},c=function(t){var e;return e=$.Deferred(),SC.get("/tracks",{q:t.query,limit:b},function(r,i){var l;return null==r||0===r.length||null!==i?void e.reject():(l=[],r.forEach(function(e){var r,i,s,c,f,d,g,p,m,h,k;return m=o.test(e.title),d=null!=e.title&&m===!0?"("+e.title.toLowerCase().replace(v,"")+")":"",null!=e.genre&&(f=e.genre.toLowerCase()),null!=e.tag_list&&(p=e.tag_list.toLowerCase().split(" ")),null!=e.created_at&&(s=e.created_at),null!=e.stream_url&&(h=e.stream_url+"?client_id="+a),null!=e.artwork_url&&(r=e.artwork_url.replace("-large","-t500x500")),null!=e.playback_count&&(k=e.playback_count),null!=e.duration&&(c=e.duration/1e3),g={title:""+t.artist+"  —  "+t.title+" "+d,song:t.title,artist:t.artist,rank:t.rank,num_days:t.num_days,change:t.change,korean:d,genre:f,tags:p,created:s,url:h,artwork:r,duration:c,views:k,score:0,query:t.query},i=n(g,t.query),g.score=u(g,t.query),i===!0&&g.score>=2?l.push(g):void 0}),l.sort(function(t,e){var r;return r=e.score-t.score,0!==r?r:e.views-t.views}),l.length>0?e.resolve(l[0]):e.reject(),void 0)}),e.promise()},e=function(t){var e,r;e=l.length,r=9,null!=t.query&&l.unshift(t.query),e>r&&l.splice(r+1,e-r)},x=function(){var t;return t=w.filter(function(t){return l.indexOf(t)<0}),t=t.filter(function(t){return d.indexOf(t)<0}),t[Math.floor(Math.random()*t.length)]},A=function(t){var r,n;return n=function(t){return c(t).done(function(t){return e(t),r.resolve(t)}).fail(function(){var e;return d.push(t),e=x(),n(e)})},r=$.Deferred(),n(t),r.promise()},i=function(){var t,e,r,n,u,i;return y=[m,k,h],e=y.indexOf(document.getElementsByClassName("active")[0]),r=y.length-1,t=null==e||e===r?0:e+1,n=t===r?0:t+1,u=n===r?0:n+1,i={active:y[t],next:y[n],onDeck:y[u],last:y[e]},i.active.classList.add("active"),i.next.classList.remove("active"),i.onDeck.classList.remove("active"),i},f=function(){var e,r,n,u,a,o;y=i(),u=x(),r=Number(y.active.getAttribute("songlength")).toHHMMSS(),e=y.active.getAttribute("artwork"),a=y.active.getAttribute("songtitle"),n=y.active.getAttribute("songlength"),o=y.active.getAttribute("src"),t(o,function(t){(404===t||503===t)&&f()}),t(e,function(t){(404===t||503===t)&&f()}),y.last.pause(),y.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=n&&void 0!==n&&$("#seek").attr("max",n),null!=a&&void 0!==a&&$("#title").text(a),null!=e&&void 0!==e&&($("#container").css("background","url("+e+") no-repeat center center fixed"),$("#container").css("background-size","cover")),A(u).done(function(t){return y.last.setAttribute("src",t.url),y.last.setAttribute("artwork",t.artwork),y.last.setAttribute("songtitle",t.title),y.last.setAttribute("songlength",t.duration)})},document.addEventListener("touchmove",function(t){return t.preventDefault()}),$("#nextButton").on("click",function(){return f()}),$("#playButton").on("click",function(){var t;return t=document.getElementsByClassName("active")[0],t.paused?($("#playButton").html("&#xf04c;"),t.play()):($("#playButton").html("&#xf04b;"),t.pause())}),_=0,C=y.length;C>_;_++)p=y[_],$(p).on("playing",function(){return $("#playButton").html("&#xf04c;")}),$(p).on("ended",function(){return f()}),$(p).on("timeupdate",function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)});$("#seek").on("input",function(){var t;return t=document.getElementsByClassName("active")[0],t.pause(),t.currentTime=this.value}),$("#seek").on("change",function(){var t;return t=document.getElementsByClassName("active")[0],t.play()}),$(document).ready(function(){var t,e,r;return t=x(),r=x(),e=x(),A(t).done(function(t){return m.setAttribute("src",t.url),m.setAttribute("artwork",t.artwork),m.setAttribute("songtitle",t.title),m.setAttribute("songlength",t.duration),null!=t.duration&&($("#endTime").val(t.duration.toHHMMSS()),$("#seek").attr("max",t.duration)),null!=t.artwork&&($("#container").css("background","url("+t.artwork+") no-repeat center center fixed"),$("#container").css("background-size","cover")),$("#title").text(t.title),$("#rank").text(t.rank),$("#change").text(t.change),$("#daysOnChart").text("Days on chart: "+t.num_days)}),A(r).done(function(t){return k.setAttribute("src",t.url),k.setAttribute("artwork",t.artwork),k.setAttribute("songtitle",t.title),k.setAttribute("songlength",t.duration)}),A(e).done(function(t){return h.setAttribute("src",t.url),h.setAttribute("artwork",t.artwork),h.setAttribute("songtitle",t.title),h.setAttribute("songlength",t.duration)})})}).call(this);
