(function(){var t,e,r,n,i,u,a,o,l,s,c,f,d,g,v,p,m,h,k,y,A,b,x,w,M,_,C,B,F,D=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};for(a="2721807f620a4047d473472d46865f14",SC.initialize({client_id:a}),A=100,M=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],r=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat"],g=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,o=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,l=[],d=[],p=document.getElementById("player_one"),h=document.getElementById("player_two"),m=document.getElementById("player_three"),k=[p,h,m],s=function(){var t;return t=null,$.ajax({async:!1,global:!1,url:"../scrape/songs.json",dataType:"json",success:function(e){t=e}}),t}(),w=[],_=0,B=s.length;B>_;_++)x=s[_],w.push(x.query);for(w=arrayUnique(w),Number.prototype.toHHMMSS=function(){var t,e,r;return t=Math.floor(this/3600),e=Math.floor(this%3600/60),r=Math.floor(this%3600%60),(t>0?t+":":"")+(e>0?(t>0&&10>e?"0":"")+e+":":"0:")+(10>r?"0":"")+r},t=function(t,e){jQuery.ajax({url:t,dataType:"text",type:"GET",complete:function(t){"function"==typeof e&&e.apply(this,[t.status])}})},n=function(t,e){var n,i,u,a,o,l,s,c,f,d,v,p,m,h,k,y,A;if(null==t.title)return!1;if(null==t.url)return!1;if(null==t.created)return!1;if(s=12,a=moment(t.created,"YYYY-MM-DD HH:MM:SS"),o=moment().subtract(s,"months"),o.diff(a,"months")>0)return!1;for(p=0,k=r.length;k>p;p++)if(v=r[p],-1!==t.title.indexOf(v))return!1;for(m=0,y=r.length;y>m;m++)if(v=r[m],null!=t.genre&&-1!==t.genre.indexOf(v))return!1;for(h=0,A=r.length;A>h;h++)if(v=r[h],D.call(t.tags,v)>=0)return!1;return l=g.test(t.title),l===!0?!1:(u=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),i=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),d=u.split(" "),c=i.split(" "),n=[d,c],f=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),0===f.length?!1:!0)},i=function(t,e){var r,n,i,u,a,l,s,c,f,d,g,v,p,m;for(s=0,f=0,a=0,i=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),n=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),m=t.genre,D.call(M,m)>=0&&(s+=1),v=0,p=M.length;p>v;v++)d=M[v],D.call(t.tags,d)>=0&&(f+=1);return f>0&&(s+=1),g=o.test(t.title),g===!0&&(s+=1),c=i.split(" "),u=n.split(" "),r=[c,u],l=r.shift().reduce(function(t,e){return-1===t.indexOf(e)&&r.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),l.length===u.length&&(s+=1),levenstein(n,i)<=10&&(s+=1),s},c=function(t){var e;return e=$.Deferred(),SC.get("/tracks",{q:t,limit:A},function(r,u){var o;return null==r||0===r.length||null!==u?void e.reject():(o=[],r.forEach(function(e){var r,u,l,s,c,f,d,g,v;return null!=e.title&&(d=e.title.toLowerCase()),null!=e.genre&&(c=e.genre.toLowerCase()),null!=e.tag_list&&(f=e.tag_list.toLowerCase().split(" ")),null!=e.created_at&&(l=e.created_at),null!=e.stream_url&&(g=e.stream_url+"?client_id="+a),null!=e.artwork_url&&(r=e.artwork_url.replace("-large","-t500x500")),null!=e.playback_count&&(v=e.playback_count),null!=e.duration&&(s=e.duration/1e3),x={title:d,genre:c,tags:f,created:l,url:g,artwork:r,duration:s,views:v,score:0,query:t},u=n(x,t),x.score=i(x,t),u===!0&&x.score>=2?o.push(x):void 0}),o.sort(function(t,e){var r;return r=e.score-t.score,0!==r?r:e.views-t.views}),o.length>0?e.resolve(o[0]):e.reject(),void 0)}),e.promise()},e=function(t){var e,r;e=l.length,r=9,null!=t.query&&l.unshift(t.query),e>r&&l.splice(r+1,e-r)},b=function(){var t;return t=w.filter(function(t){return l.indexOf(t)<0}),t=t.filter(function(t){return d.indexOf(t)<0}),t[Math.floor(Math.random()*t.length)]},y=function(t){var r,n;return n=function(t){return c(t).done(function(t){return e(t),r.resolve(t)}).fail(function(){var e;return d.push(t),e=b(),n(e)})},r=$.Deferred(),n(t),r.promise()},u=function(){var t,e,r,n,i,u;return k=[p,h,m],e=k.indexOf(document.getElementsByClassName("active")[0]),r=k.length-1,t=null==e||e===r?0:e+1,n=t===r?0:t+1,i=n===r?0:n+1,u={active:k[t],next:k[n],onDeck:k[i],last:k[e]},u.active.classList.add("active"),u.next.classList.remove("active"),u.onDeck.classList.remove("active"),u},f=function(){var e,r,n,i,a,o;k=u(),i=b(),r=Number(k.active.getAttribute("songlength")).toHHMMSS(),e=k.active.getAttribute("artwork"),a=k.active.getAttribute("songtitle"),n=k.active.getAttribute("songlength"),o=k.active.getAttribute("src"),t(o,function(t){(404===t||503===t)&&f()}),t(e,function(t){(404===t||503===t)&&f()}),k.last.pause(),k.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=n&&void 0!==n&&$("#seek").attr("max",n),null!=a&&void 0!==a&&$("#title").text(a),null!=e&&void 0!==e&&($("#container").css("background","url("+e+") no-repeat center center fixed"),$("#container").css("background-size","cover")),y(i).done(function(t){return k.last.setAttribute("src",t.url),k.last.setAttribute("artwork",t.artwork),k.last.setAttribute("songtitle",t.title),k.last.setAttribute("songlength",t.duration)})},document.addEventListener("touchmove",function(t){return t.preventDefault()}),$("#nextButton").on("click",function(){return f()}),$("#playButton").on("click",function(){var t;return t=document.getElementsByClassName("active")[0],t.paused?($("#playButton").html("&#xf04c;"),t.play()):($("#playButton").html("&#xf04b;"),t.pause())}),C=0,F=k.length;F>C;C++)v=k[C],$(v).on("playing",function(){return $("#playButton").html("&#xf04c;")}),$(v).on("ended",function(){return f()}),$(v).on("timeupdate",function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)});$("#seek").on("input",function(){var t;return t=document.getElementsByClassName("active")[0],t.pause(),t.currentTime=this.value}),$("#seek").on("change",function(){var t;return t=document.getElementsByClassName("active")[0],t.play()}),$(document).ready(function(){var t,e,r;return t=b(),r=b(),e=b(),y(t).done(function(t){return p.setAttribute("src",t.url),p.setAttribute("artwork",t.artwork),p.setAttribute("songtitle",t.title),p.setAttribute("songlength",t.duration),null!=t.duration&&($("#endTime").val(t.duration.toHHMMSS()),$("#seek").attr("max",t.duration)),null!=t.artwork&&($("#container").css("background","url("+t.artwork+") no-repeat center center fixed"),$("#container").css("background-size","cover")),$("#title").text(t.title)}),y(r).done(function(t){return h.setAttribute("src",t.url),h.setAttribute("artwork",t.artwork),h.setAttribute("songtitle",t.title),h.setAttribute("songlength",t.duration)}),y(e).done(function(t){return m.setAttribute("src",t.url),m.setAttribute("artwork",t.artwork),m.setAttribute("songtitle",t.title),m.setAttribute("songlength",t.duration)})})}).call(this);
