(function(){var t,e,n,r,a,u,i,o,l,s,c,g,d,f,h,m,p,v,k,y,A,b,x,w,_,F,C,D,M=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};for(i="2721807f620a4047d473472d46865f14",SC.initialize({client_id:i}),b=100,F=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],n=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat"],f=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,l=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,h=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,s=[],d=[],p=document.getElementById("player_one"),k=document.getElementById("player_two"),v=document.getElementById("player_three"),y=[p,k,v],o=function(){var t;return t=null,t=new XMLHttpRequest,t.open("GET","http://jombly.com:3000/today",!1),t.send(null),t.responseText},w=JSON.parse(o()),_=arrayUnique(w),Number.prototype.toHHMMSS=function(){var t,e,n;return t=Math.floor(this/3600),e=Math.floor(this%3600/60),n=Math.floor(this%3600%60),(t>0?t+":":"")+(e>0?(t>0&&10>e?"0":"")+e+":":"0:")+(10>n?"0":"")+n},t=function(t,e){jQuery.ajax({url:t,dataType:"text",type:"GET",complete:function(t){"function"==typeof e&&e.apply(this,[t.status])}})},r=function(t,e){var r,a,u,i,o,l,s,c,g,d,h,m,p,v,k,y,A;if(null==t.title)return!1;if(null==t.url)return!1;if(null==t.created)return!1;if(s=12,i=moment(t.created,"YYYY-MM-DD HH:MM:SS"),o=moment().subtract(s,"months"),o.diff(i,"months")>0)return!1;if(t.duration>360)return!1;for(m=0,k=n.length;k>m;m++)if(h=n[m],-1!==t.title.indexOf(h))return!1;for(p=0,y=n.length;y>p;p++)if(h=n[p],null!=t.genre&&-1!==t.genre.indexOf(h))return!1;for(v=0,A=n.length;A>v;v++)if(h=n[v],M.call(t.tags,h)>=0)return!1;return l=f.test(t.title),l===!0?!1:(u=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),a=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),d=u.split(" "),c=a.split(" "),r=[d,c],g=r.shift().reduce(function(t,e){return-1===t.indexOf(e)&&r.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),0===g.length?!1:!0)},a=function(t,e){var n,r,a,u,i,o,s,c,g,d,f,h,m,p;for(s=0,g=0,i=0,a=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),p=t.genre,M.call(F,p)>=0&&(s+=1),h=0,m=F.length;m>h;h++)d=F[h],M.call(t.tags,d)>=0&&(g+=1);return g>0&&(s+=1),f=l.test(t.title),f===!0&&(s+=1),c=a.split(" "),u=r.split(" "),n=[c,u],o=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),o.length===u.length&&(s+=1),levenstein(r,a)<=10&&(s+=1),s},c=function(t){var e;return e=$.Deferred(),SC.get("/tracks",{q:t.query,limit:b},function(n,u){var o;return null==n||0===n.length||null!==u?void e.reject():(o=[],n.forEach(function(e){var n,u,s,c,g,d,f,m,p,v,k;return p=l.test(e.title),d=null!=e.title&&p===!0?"("+e.title.toLowerCase().replace(h,"")+")":"",null!=e.genre&&(g=e.genre.toLowerCase()),null!=e.tag_list&&(m=e.tag_list.toLowerCase().split(" ")),null!=e.created_at&&(s=e.created_at),null!=e.stream_url&&(v=e.stream_url+"?client_id="+i),null!=e.artwork_url&&(n=e.artwork_url.replace("-large","-t500x500")),null!=e.playback_count&&(k=e.playback_count),null!=e.duration&&(c=e.duration/1e3),f={title:""+t.artist+"  —  "+t.title+" "+d,song:t.title,artist:t.artist,rank:t.rank,num_days:t.num_days,change:t.change,korean:d,genre:g,tags:m,created:s,url:v,artwork:n,duration:c,views:k,score:0,query:t.query},u=r(f,t.query),f.score=a(f,t.query),u===!0&&f.score>=3?o.push(f):void 0}),o.sort(function(t,e){return e.views-t.views}),o.length>0?e.resolve(o[0]):e.reject(),void 0)}),e.promise()},e=function(t){var e,n;e=s.length,n=9,null!=t.query&&s.unshift(t.query),e>n&&s.splice(n+1,e-n)},x=function(){var t;return t=_.filter(function(t){return s.indexOf(t)<0}),t=t.filter(function(t){return d.indexOf(t)<0}),t[Math.floor(Math.random()*t.length)]},A=function(t){var n,r;return r=function(t){return c(t).done(function(t){return e(t),n.resolve(t)}).fail(function(){var e;return d.push(t),e=x(),r(e)})},n=$.Deferred(),r(t),n.promise()},u=function(){var t,e,n,r,a,u;return y=[p,k,v],e=y.indexOf(document.getElementsByClassName("active")[0]),n=y.length-1,t=null==e||e===n?0:e+1,r=t===n?0:t+1,a=r===n?0:r+1,u={active:y[t],next:y[r],onDeck:y[a],last:y[e]},u.active.classList.add("active"),u.next.classList.remove("active"),u.onDeck.classList.remove("active"),u},g=function(){var e,n,r,a,i,o,l,s,c;y=u(),o=x(),r=Number(y.active.getAttribute("songlength")).toHHMMSS(),e=y.active.getAttribute("artwork"),s=y.active.getAttribute("songtitle"),a=y.active.getAttribute("songlength"),c=y.active.getAttribute("src"),l=y.active.getAttribute("rank"),n=y.active.getAttribute("change"),i=y.active.getAttribute("num_days"),t(c,function(t){(404===t||503===t)&&g()}),t(e,function(t){(404===t||503===t)&&g()}),y.last.pause(),y.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=a&&void 0!==a&&$("#seek").attr("max",a),null!=s&&void 0!==s&&$("#title").text(s),null!=e&&void 0!==e&&$("#container").css("background","url("+e+") no-repeat center center"),$("#title").text(s),$("#rank").text("Rank "+l),0>n&&($("#change").css("color","#D7431B"),$("#change").text("( "+n+" )")),n>0&&($("#change").css("color","#288668"),$("#change").text("( +"+n+" )")),0===n&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+i+" days on chart"),A(o).done(function(t){return y.last.setAttribute("src",t.url),y.last.setAttribute("artwork",t.artwork),y.last.setAttribute("songtitle",t.title),y.last.setAttribute("songlength",t.duration),y.last.setAttribute("rank",t.rank),y.last.setAttribute("change",t.change),y.last.setAttribute("num_days",t.num_days)})},document.addEventListener("touchmove",function(t){return t.preventDefault()}),$("#nextButton").on("click",function(){return g()}),$("#playButton").on("click",function(){var t;return t=document.getElementsByClassName("active")[0],t.paused?($("#playButton").html("&#xf04c;"),t.play()):($("#playButton").html("&#xf04b;"),t.pause())}),C=0,D=y.length;D>C;C++)m=y[C],$(m).on("playing",function(){return $("#playButton").html("&#xf04c;")}),$(m).on("ended",function(){return g()}),$(m).on("timeupdate",function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)});$("#seek").on("input",function(){var t;return t=document.getElementsByClassName("active")[0],t.pause(),t.currentTime=this.value}),$("#seek").on("change",function(){var t;return t=document.getElementsByClassName("active")[0],t.play()}),$(document).ready(function(){var t,e,n;return t=x(),n=x(),e=x(),A(t).done(function(t){return p.setAttribute("src",t.url),p.setAttribute("artwork",t.artwork),p.setAttribute("songtitle",t.title),p.setAttribute("songlength",t.duration),p.setAttribute("rank",t.rank),p.setAttribute("change",t.change),p.setAttribute("num_days",t.num_days),null!=t.duration&&($("#endTime").val(t.duration.toHHMMSS()),$("#seek").attr("max",t.duration)),null!=t.artwork&&$("#container").css("background","url("+t.artwork+") no-repeat center center"),$("#title").text(t.title),$("#rank").text("Rank "+t.rank),t.change<0&&($("#change").css("color","#D7431B"),$("#change").text("( "+t.change+" )")),t.change>0&&($("#change").css("color","#288668"),$("#change").text("( +"+t.change+" )")),0===t.change&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+t.num_days+" days on chart")}),A(n).done(function(t){return k.setAttribute("src",t.url),k.setAttribute("artwork",t.artwork),k.setAttribute("songtitle",t.title),k.setAttribute("songlength",t.duration),k.setAttribute("rank",t.rank),k.setAttribute("change",t.change),k.setAttribute("num_days",t.num_days)}),A(e).done(function(t){return v.setAttribute("src",t.url),v.setAttribute("artwork",t.artwork),v.setAttribute("songtitle",t.title),v.setAttribute("songlength",t.duration),v.setAttribute("rank",t.rank),v.setAttribute("change",t.change),v.setAttribute("num_days",t.num_days)})})}).call(this);
