(function(){var e,t,n,r,u,a,o,i,l,c,s,d,g,f,v,h,m,p,y,k,x,b,A,_,w,D,C,B,E,F,M,O,S,T,q,L,N,H,j,z,I,R,Y=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};for(o="2721807f620a4047d473472d46865f14",SC.initialize({client_id:o}),B=100,T=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],n=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat","short","club"],p=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,g=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,y=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,f=[],m=[],s=function(e){var t,n;return t=new RegExp(e+"=([^;]+)"),n=t.exec(document.cookie),null!=n?unescape(n[1]):null},l=s("dontPlay"),c=null!==l?JSON.parse(l):[],A=document.getElementById("player_one"),w=document.getElementById("player_two"),_=document.getElementById("player_three"),b=document.getElementById("player_four"),x=document.getElementById("player_five"),D=[A,w,_,b,x],d=function(){var e;return e=null,e=new XMLHttpRequest,e.open("GET","http://jombly.com:3000/today",!1),e.send(null),e.responseText},$.post("http://localhost:3000/vote",{user:"test",password:"test2"},function(e){"done"===e&&alert("login success")}),O=JSON.parse(d()),S=arrayUnique(O),S=S.filter(function(e){return c.indexOf(e.query)<0}),Number.prototype.toHHMMSS=function(){var e,t,n;return e=Math.floor(this/3600),t=Math.floor(this%3600/60),n=Math.floor(this%3600%60),(e>0?e+":":"")+(t>0?(e>0&&10>t?"0":"")+t+":":"0:")+(10>n?"0":"")+n},e=function(e,t){jQuery.ajax({url:e,dataType:"text",type:"GET",complete:function(e){"function"==typeof t&&t.apply(this,[e.status])}})},r=function(e,t){var r,u,a,o,i,l,c,s,d,g,f,v,h,m,y,k,$;if(null==e.orig_title)return!1;if(null==e.url)return!1;if(null==e.created)return!1;if(c=12,o=moment(e.created,"YYYY-MM-DD HH:MM:SS"),i=moment().subtract(c,"months"),i.diff(o,"months")>0)return!1;if(e.duration>360)return!1;for(v=0,y=n.length;y>v;v++)if(f=n[v],-1!==e.orig_title.indexOf(f))return!1;for(h=0,k=n.length;k>h;h++)if(f=n[h],null!=e.genre&&-1!==e.genre.indexOf(f))return!1;for(m=0,$=n.length;$>m;m++)if(f=n[m],Y.call(e.tags,f)>=0)return!1;return l=p.test(e.orig_title),l===!0?!1:(a=e.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),u=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),g=a.split(" "),s=u.split(" "),r=[g,s],d=r.shift().reduce(function(e,t){return-1===e.indexOf(t)&&r.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),0===d.length?!1:levenstein(u,a)>=8?!1:!0)},u=function(e,t){var n,r,u,a,o,i,l,c,s,d,f,v,h,m;for(l=0,s=0,o=0,u=e.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),m=e.genre,Y.call(T,m)>=0&&(l+=1),v=0,h=T.length;h>v;v++)d=T[v],Y.call(e.tags,d)>=0&&(s+=1);return s>0&&(l+=1),f=g.test(e.orig_title),f===!0&&(l+=1),c=u.split(" "),a=r.split(" "),n=[c,a],i=n.shift().reduce(function(e,t){return-1===e.indexOf(t)&&n.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),i.length===a.length&&(l+=1),levenstein(r,u)<=5&&(l+=1),l},v=function(e){var t;return t=$.Deferred(),SC.get("/tracks",{q:e.query,limit:B},function(n,a){var i;return null==n||0===n.length||null!==a?void t.reject():(i=[],n.forEach(function(t){var n,a,l,c,s,d,f,v,h,m,p;return h=g.test(t.title),d=null!=t.title&&h===!0?"("+t.title.toLowerCase().replace(y,"")+")":"",null!=t.genre&&(s=t.genre.toLowerCase()),null!=t.tag_list&&(v=t.tag_list.toLowerCase().split(" ")),null!=t.created_at&&(l=t.created_at),null!=t.stream_url&&(m=t.stream_url+"?client_id="+o),null!=t.artwork_url&&(n=t.artwork_url.replace("-large","-t500x500")),null!=t.playback_count&&(p=t.playback_count),null!=t.duration&&(c=t.duration/1e3),f={title:""+e.artist+"  —  "+e.title+" "+d,orig_title:t.title,song:e.title,artist:e.artist,rank:e.rank,num_days:e.num_days,change:e.change,korean:d,genre:s,tags:v,created:l,url:m,artwork:n,duration:c,views:p,score:0,query:e.query},a=r(f,e.query),f.score=u(f,e.query),a===!0&&f.score>=2?i.push(f):void 0}),i.sort(function(e,t){var n;return n=t.score-e.score,0!==n?n:t.views-e.views}),i.length>0?t.resolve(i[0]):t.reject(),void 0)}),t.promise()},t=function(e){var t,n;t=f.length,n=19,null!=e.query&&f.unshift(e.query),t>n&&f.splice(n+1,t-n)},E=function(){var e;return e=S.filter(function(e){return f.indexOf(e.query)<0}),e=e.filter(function(e){return m.indexOf(e.query)<0}),e=e.filter(function(e){return c.indexOf(e.query)<0}),e[Math.floor(Math.random()*e.length)]},C=function(e){var n,r;return r=function(e){return v(e).done(function(e){return t(e),n.resolve(e)}).fail(function(){var t;return m.push(e),t=E(),r(t)})},n=$.Deferred(),r(e),n.promise()},a=function(){var e,t,n,r,u,a,o,i;return D=[A,w,_,b,x],t=D.indexOf(document.getElementsByClassName("active")[0]),n=D.length-1,e=null==t||t===n?0:t+1,r=e===n?0:e+1,u=r===n?0:r+1,o=u===n?0:u+1,a=o===n?0:o+1,i={active:D[e],next:D[r],onDeck:D[u],onDeckTwo:D[o],onDeckThree:D[a],last:D[t]},i.active.classList.add("active"),i.next.classList.remove("active"),i.onDeck.classList.remove("active"),i.onDeckTwo.classList.remove("active"),i.onDeckThree.classList.remove("active"),i},F=function(e,t){var n;return n=e.getElementsByTagName("SOURCE")[0],n.setAttribute("src",t.url),e.setAttribute("artwork",t.artwork),e.setAttribute("songtitle",t.title),e.setAttribute("songlength",t.duration),e.setAttribute("rank",t.rank),e.setAttribute("change",t.change),e.setAttribute("num_days",t.num_days),e.setAttribute("query",t.query),e.load()},h=function(){var t,n,r,u,o,i,l,c,s,d;D=a(),c=D.active.getElementsByTagName("SOURCE")[0],i=E(),r=Number(D.active.getAttribute("songlength")).toHHMMSS(),t=D.active.getAttribute("artwork"),s=D.active.getAttribute("songtitle"),u=D.active.getAttribute("songlength"),d=c.getAttribute("src"),l=D.active.getAttribute("rank"),n=D.active.getAttribute("change"),o=D.active.getAttribute("num_days"),e(d,function(e){(404===e||503===e)&&h()}),e(t,function(e){(404===e||503===e)&&h()}),D.last.pause(),D.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=u&&void 0!==u&&$("#seek").attr("max",u),null!=s&&void 0!==s&&$("#title").text(s),null!=t&&void 0!==t&&$("#container").css("background","url("+t+") no-repeat center center"),$("#title").text(s),document.title=s,$("#rank").text("Rank "+l),0>n&&($("#change").css("color","#D7431B"),$("#change").text("( "+n+" )")),n>0&&($("#change").css("color","#288668"),$("#change").text("( +"+n+" )")),0===n&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+o+" days on chart"),$("#recentSongs").prepend("<li>"+D.last.getAttribute("songtitle")+"</li><button class='removeThumb'>&#xf00d;</button>"),C(i).done(function(e){return F(D.last,e)})},document.addEventListener("touchmove",function(e){return"INPUT"!==e.target.tagName?e.preventDefault():void 0}),q=void 0,L=0,document.addEventListener("touchstart",function(e){q=e.touches[0].screenX,L=e.touches[0].screenY}),document.addEventListener("touchmove",function(e){var t,n;t=Math.abs(e.touches[0].screenX-q),n=Math.abs(e.touches[0].screenY-L),3*n>t&&e.preventDefault()}),$("#test").on("click",function(){var e,t;return e=document.getElementsByClassName("active")[0],t=e.getAttribute("query")}),$("#nextButton").on("click",function(){return h()}),$("#playButton").on("click",function(){var e;return e=document.getElementsByClassName("active")[0],e.paused?($("#playButton").html("&#xf04c;"),e.play()):($("#playButton").html("&#xf04b;"),e.pause())}),N=0,z=D.length;z>N;N++)k=D[N],k.volume=.5,k.oncanplay=function(){var e,t;return e=this,t=1e3*(this.duration+30),setTimeout(function(){var t;e.paused&&(t=E(),C(t).done(function(t){return F(e,t)}))},t)},k.onerror=function(){return h()},k.onplaying=function(){return $("#playButton").html("&#xf04c;")},k.onended=function(){return h()},k.ontimeupdate=function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)};for($("#seek").on("input",function(){var e;return e=document.getElementsByClassName("active")[0],e.pause(),e.currentTime=this.value}),$("#seek").on("change",function(){var e;return e=document.getElementsByClassName("active")[0],e.play()}),$("#volume").on("input change",function(){return A.volume=this.value,w.volume=this.value,_.volume=this.value,b.volume=this.value,x.volume=this.value}),$("#dontPlay").on("click",function(){var e,t,n;return e=document.getElementsByClassName("active")[0],t=e.getAttribute("query"),n=e.getAttribute("songtitle"),c.push(t),document.cookie="dontPlay="+JSON.stringify(c),$("#thumbsDownSongs").prepend("<li>"+n+"</li>"),h()}),$("#showOverlay").on("click",function(){return $("#overlay").toggleClass("hidden"),$("#container").toggleClass("hidden")}),H=0,I=c.length;I>H;H++)M=c[H],$("#thumbsDownSongs").prepend("<li>"+M+"</li>");for(j=0,R=S.length;R>j;j++)M=S[j],i=""+M.artist+" - "+M.title,$("#topList").append("<li>"+i+"</li>");$(document).ready(function(){var t,n,r,u,a;return r=E(),a=E(),u=E(),n=E(),t=E(),C(r).done(function(t){return F(A,t),e(t.url,function(e){(404===e||503===e)&&h()}),e(t.artwork,function(e){(404===e||503===e)&&h()}),null!=t.duration&&($("#endTime").val(t.duration.toHHMMSS()),$("#seek").attr("max",t.duration)),null!=t.artwork&&$("#container").css("background","url("+t.artwork+") no-repeat center center"),$("#title").text(t.title),$("#rank").text("Rank "+t.rank),t.change<0&&($("#change").css("color","#D7431B"),$("#change").text("( "+t.change+" )")),t.change>0&&($("#change").css("color","#288668"),$("#change").text("( +"+t.change+" )")),0===t.change&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+t.num_days+" days on chart")}),C(a).done(function(e){return F(w,e)}),C(u).done(function(e){return F(_,e)}),C(n).done(function(e){return F(b,e)}),C(t).done(function(e){return F(x,e)})})}).call(this);
