(function(){var t,e,n,r,o,i,u,a,l,c,s,d,f,v,g,m,p,h,y,k,b,w,x,A,C,_,O,S,B,D,E,F,M,q,T,L,N,j,H,z,I,R,Y,J,Z,P=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};for(a="2721807f620a4047d473472d46865f14",SC.initialize({client_id:a}),D=100,N=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],r=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat","short","club"],k=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,g=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,b=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,m=[],y=[],d=function(t){var e,n;return e=new RegExp(t+"=([^;]+)"),n=e.exec(document.cookie),null!=n?unescape(n[1]):null},v=function(){var t;return t=null,t=new XMLHttpRequest,t.open("GET","http://jombly.com:3000/today",!1),t.send(null),t.responseText},f=function(t){return $.post("http://jombly.com:3000/getSong",{query:t},function(t){return t})},c=d("dontPlay"),s=null!==c?JSON.parse(c):[],C=document.getElementById("player_one"),O=document.getElementById("player_two"),_=document.getElementById("player_three"),A=document.getElementById("player_four"),x=document.getElementById("player_five"),S=[C,O,_,A,x],q=[],T=JSON.parse(v()),L=arrayUnique(T),L=L.filter(function(t){return s.indexOf(t.query)<0}),Number.prototype.toHHMMSS=function(){var t,e,n;return t=Math.floor(this/3600),e=Math.floor(this%3600/60),n=Math.floor(this%3600%60),(t>0?t+":":"")+(e>0?(t>0&&10>e?"0":"")+e+":":"0:")+(10>n?"0":"")+n},e=function(t,e){jQuery.ajax({url:t,dataType:"text",type:"GET",complete:function(t){"function"==typeof e&&e.apply(this,[t.status])}})},t=function(t){var e;return e=t.toString().split("."),e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},o=function(t,e){var n,o,i,u,a,l,c,s,d,f,v,g,m,p,h,y,$;if(null==t.orig_title)return!1;if(null==t.url)return!1;if(null==t.created)return!1;if(c=12,u=moment(t.created,"YYYY-MM-DD HH:MM:SS"),a=moment().subtract(c,"months"),a.diff(u,"months")>0)return!1;if(t.duration>360)return!1;for(g=0,h=r.length;h>g;g++)if(v=r[g],-1!==t.orig_title.indexOf(v))return!1;for(m=0,y=r.length;y>m;m++)if(v=r[m],null!=t.genre&&-1!==t.genre.indexOf(v))return!1;for(p=0,$=r.length;$>p;p++)if(v=r[p],P.call(t.tags,v)>=0)return!1;return l=k.test(t.orig_title),l===!0?!1:(i=t.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),o=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),f=i.split(" "),s=o.split(" "),n=[f,s],d=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),0===d.length?!1:levenstein(o,i)>=8?!1:!0)},i=function(t,e){var n,r,o,i,u,a,l,c,s,d,f,v,m,p;for(l=0,s=0,u=0,o=t.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),p=t.genre,P.call(N,p)>=0&&(l+=1),v=0,m=N.length;m>v;v++)d=N[v],P.call(t.tags,d)>=0&&(s+=1);return s>0&&(l+=1),f=g.test(t.orig_title),f===!0&&(l+=1),c=o.split(" "),i=r.split(" "),n=[c,i],a=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),a.length===i.length&&(l+=1),levenstein(r,o)<=5&&(l+=1),l},p=function(t){var e;return e=$.Deferred(),SC.get("/tracks",{q:t.query,limit:D},function(n,r){var u;return null==n||0===n.length||null!==r?void e.reject():(u=[],n.forEach(function(e){var n,r,l,c,s,d,f,v,m,p,h;return m=g.test(e.title),d=null!=e.title&&m===!0?"("+e.title.toLowerCase().replace(b,"")+")":"",null!=e.genre&&(s=e.genre.toLowerCase()),null!=e.tag_list&&(v=e.tag_list.toLowerCase().split(" ")),null!=e.created_at&&(l=e.created_at),null!=e.stream_url&&(p=e.stream_url+"?client_id="+a),null!=e.artwork_url&&(n=e.artwork_url.replace("-large","-t500x500")),null!=e.playback_count&&(h=e.playback_count),null!=e.duration&&(c=e.duration/1e3),f={title:""+t.artist+"  —  "+t.title+" "+d,orig_title:e.title,song:t.title,artist:t.artist,rank:t.rank,korean:d,genre:s,tags:v,created:l,url:p,artwork:n,duration:c,views:h,score:0,query:t.query},r=o(f,t.query),f.score=i(f,t.query),r===!0&&f.score>=2?u.push(f):void 0}),u.sort(function(t,e){var n;return n=e.score-t.score,0!==n?n:e.views-t.views}),u.length>0?e.resolve(u[0]):e.reject(),void 0)}),e.promise()},n=function(t){var e,n;e=m.length,n=19,null!=t.query&&m.unshift(t.query),e>n&&m.splice(n+1,e-n)},E=function(){var t;return t=L.filter(function(t){return m.indexOf(t.query)<0}),t=t.filter(function(t){return y.indexOf(t.query)<0}),t=t.filter(function(t){return s.indexOf(t.query)<0}),t[Math.floor(Math.random()*t.length)]},B=function(t){var e,r;return r=function(t){return p(t).done(function(t){return n(t),e.resolve(t)}).fail(function(){var e;return y.push(t),e=E(),r(e)})},e=$.Deferred(),r(t),e.promise()},u=function(){var t,e,n,r,o,i,u,a;return S=[C,O,_,A,x],e=S.indexOf(document.getElementsByClassName("active")[0]),n=S.length-1,t=null==e||e===n?0:e+1,r=t===n?0:t+1,o=r===n?0:r+1,u=o===n?0:o+1,i=u===n?0:u+1,a={active:S[t],next:S[r],onDeck:S[o],onDeckTwo:S[u],onDeckThree:S[i],last:S[e]},a.active.classList.add("active"),a.next.classList.remove("active"),a.onDeck.classList.remove("active"),a.onDeckTwo.classList.remove("active"),a.onDeckThree.classList.remove("active"),a},F=function(t,e){var n;return n=t.getElementsByTagName("SOURCE")[0],n.setAttribute("src",e.url),t.setAttribute("artwork",e.artwork),t.setAttribute("songtitle",e.title),t.setAttribute("songlength",e.duration),t.setAttribute("rank",e.rank),t.setAttribute("query",e.query),t.load()},h=function(){var t,n,r,o,i,a,l,c,s;S=u(),l=S.active.getElementsByTagName("SOURCE")[0],i=E(),n=Number(S.active.getAttribute("songlength")).toHHMMSS(),t=S.active.getAttribute("artwork"),c=S.active.getAttribute("songtitle"),r=S.active.getAttribute("songlength"),s=l.getAttribute("src"),a=S.active.getAttribute("rank"),e(s,function(t){(404===t||503===t)&&h()}),e(t,function(t){(404===t||503===t)&&h()}),S.last.pause(),S.active.play(),null!=n&&void 0!==n&&$("#endTime").val(n),null!=r&&void 0!==r&&$("#seek").attr("max",r),null!=c&&void 0!==c&&$("#title").text(c),null!=t&&void 0!==t&&$("#container").css("background","url("+t+") no-repeat center center"),$("#title").text(c),document.title=c,$("#rank").text("Rank "+a),$("#recentSongs").prepend("<li>"+S.last.getAttribute("songtitle")+"</li><button class='removeThumb'>&#xf00d;</button>"),o=S.active.getAttribute("query"),B(i).done(function(t){return F(S.last,t)})},document.addEventListener("touchmove",function(t){return"INPUT"!==t.target.tagName?t.preventDefault():void 0}),j=void 0,H=0,document.addEventListener("touchstart",function(t){j=t.touches[0].screenX,H=t.touches[0].screenY}),document.addEventListener("touchmove",function(t){var e,n;e=Math.abs(t.touches[0].screenX-j),n=Math.abs(t.touches[0].screenY-H),3*n>e&&t.preventDefault()}),z=0,Y=S.length;Y>z;z++)w=S[z],w.volume=.5,w.oncanplay=function(){var t,e;return t=this,e=1e3*(this.duration+30),setTimeout(function(){var e;t.paused&&(e=E(),B(e).done(function(e){return F(t,e)}))},e)},w.onerror=function(){return h()},w.onplaying=function(){return $("#playButton").html("&#xf04c;")},w.onended=function(){return h()},w.ontimeupdate=function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)};for($("#nextButton").on("click",function(){return h()}),$("#playButton").on("click",function(){var t;return t=document.getElementsByClassName("active")[0],t.paused?($("#playButton").html("&#xf04c;"),t.play()):($("#playButton").html("&#xf04b;"),t.pause())}),$("#seek").on("input",function(){var t;return t=document.getElementsByClassName("active")[0],t.pause(),t.currentTime=this.value}),$("#seek").on("change",function(){var t;return t=document.getElementsByClassName("active")[0],t.play()}),$("#volume").on("input change",function(){return C.volume=this.value,O.volume=this.value,_.volume=this.value,A.volume=this.value,x.volume=this.value}),$("#dontPlay").on("click",function(){var t,e,n;return t=document.getElementsByClassName("active")[0],e=t.getAttribute("query"),n=t.getAttribute("songtitle"),s.push(e),document.cookie="dontPlay="+JSON.stringify(s),$("#thumbsDownSongs").prepend("<li>"+n+"</li>"),h()}),$(".options").on("click",function(){return $(".options").toggleClass("activeOpts"),$(".options").toggleClass("rotate"),$("#optionsContainer").toggleClass("hideBottom"),$("#playerControls").toggleClass("hideBottom")}),$("#showOverlay").on("click",function(){var t;return $("#showOverlay").toggleClass("active"),t=$("#showOverlay").hasClass("active"),t===!0?($("#overlay").removeClass("hidden"),$("#container").addClass("hidden")):($("#overlay").addClass("hidden"),$("#container").removeClass("hidden")),t=$("#showOverlay").hasClass("active")}),I=0,J=s.length;J>I;I++)M=s[I],$("#thumbsDownSongs").prepend("<li>"+M+"</li>");for(R=0,Z=L.length;Z>R;R++)M=L[R],l=""+M.artist+" - "+M.title,$("#topList").append("<li>"+l+"</li>");$(document).ready(function(){var n,r,o,i,u;return o=E(),u=E(),i=E(),r=E(),n=E(),B(o).done(function(t){return F(C,t),e(t.url,function(t){(404===t||503===t)&&h()}),e(t.artwork,function(t){(404===t||503===t)&&h()}),null!=t.duration&&($("#endTime").val(t.duration.toHHMMSS()),$("#seek").attr("max",t.duration)),null!=t.artwork&&$("#container").css("background","url("+t.artwork+") no-repeat center center"),$("#title").text(t.title),$("#rank").text("Rank "+t.rank)}),B(u).done(function(t){return F(O,t)}),B(i).done(function(t){return F(_,t)}),B(r).done(function(t){return F(A,t)}),B(n).done(function(t){return F(x,t)}),$.getJSON("http://graph.facebook.com/?id=http://www.jombly.com",function(e){$("#facebook-count").text(t(e.shares))}),$.getJSON("http://cdn.api.twitter.com/1/urls/count.json?url=http://www.jombly.com&callback=?",function(e){$("#twitter-count").text(t(e.count))})})}).call(this);
