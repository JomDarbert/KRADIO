(function(){var t,e,n,r,o,i,u,a,l,c,s,f,d,g,p,v,m,h,y,k,w,x,b,A,C,_,S,O,B,D,F,T,q,E,M,L,N,j,H,z,R,Z,I,J,Y=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};for(a="2721807f620a4047d473472d46865f14",SC.initialize({client_id:a}),F=100,j=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],r=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat","short","club"],w=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,v=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,x=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,m=[],k=[],f=function(t){var e,n;return e=new RegExp(t+"=([^;]+)"),n=e.exec(document.cookie),null!=n?unescape(n[1]):null},p=function(){var t;return t=null,t=new XMLHttpRequest,t.open("GET","http://jombly.com:3000/today",!1),t.send(null),t.responseText},g=function(t){return $.post("http://jombly.com:3000/getSong",{query:t},function(t){return t})},c=f("dontPlay"),s=null!==c?JSON.parse(c):[],_=document.getElementById("player_one"),O=document.getElementById("player_two"),S=document.getElementById("player_three"),C=document.getElementById("player_four"),A=document.getElementById("player_five"),B=[_,O,S,C,A],M=[],L=JSON.parse(p()),N=arrayUnique(L),N=N.filter(function(t){return s.indexOf(t.query)<0}),Number.prototype.toHHMMSS=function(){var t,e,n;return t=Math.floor(this/3600),e=Math.floor(this%3600/60),n=Math.floor(this%3600%60),(t>0?t+":":"")+(e>0?(t>0&&10>e?"0":"")+e+":":"0:")+(10>n?"0":"")+n},e=function(t,e){jQuery.ajax({url:t,dataType:"text",type:"GET",complete:function(t){"function"==typeof e&&e.apply(this,[t.status])}})},t=function(t){var e;return e=t.toString().split("."),e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},o=function(t,e){var n,o,i,u,a,l,c,s,f,d,g,p,v,m,h,y,k;if(null==t.orig_title)return!1;if(null==t.url)return!1;if(null==t.created)return!1;if(c=12,u=moment(t.created,"YYYY-MM-DD HH:MM:SS"),a=moment().subtract(c,"months"),a.diff(u,"months")>0)return!1;if(t.duration>360)return!1;for(p=0,h=r.length;h>p;p++)if(g=r[p],-1!==t.orig_title.indexOf(g))return!1;for(v=0,y=r.length;y>v;v++)if(g=r[v],null!=t.genre&&-1!==t.genre.indexOf(g))return!1;for(m=0,k=r.length;k>m;m++)if(g=r[m],Y.call(t.tags,g)>=0)return!1;return l=w.test(t.orig_title),l===!0?!1:(i=t.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),o=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),d=i.split(" "),s=o.split(" "),n=[d,s],f=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),0===f.length?!1:levenstein(o,i)>=8?!1:!0)},i=function(t,e){var n,r,o,i,u,a,l,c,s,f,d,g,p,m;for(l=0,s=0,u=0,o=t.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),m=t.genre,Y.call(j,m)>=0&&(l+=1),g=0,p=j.length;p>g;g++)f=j[g],Y.call(t.tags,f)>=0&&(s+=1);return s>0&&(l+=1),d=v.test(t.orig_title),d===!0&&(l+=1),c=o.split(" "),i=r.split(" "),n=[c,i],a=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),a.length===i.length&&(l+=1),levenstein(r,o)<=5&&(l+=1),l},h=function(t){var e;return e=$.Deferred(),SC.get("/tracks",{q:t.query,limit:F},function(n,r){var u;return null==n||0===n.length||null!==r?void e.reject():(u=[],n.forEach(function(e){var n,r,l,c,s,f,d,g,p,m,h,y;return m=v.test(e.title),f=null!=e.title&&m===!0?"("+e.title.toLowerCase().replace(x,"")+")":"",null!=e.genre&&(s=e.genre.toLowerCase()),null!=e.tag_list&&(p=e.tag_list.toLowerCase().split(" ")),null!=e.created_at&&(l=e.created_at),null!=e.stream_url&&(h=e.stream_url+"?client_id="+a),null!=e.permalink_url&&(d=e.permalink_url),null!=e.artwork_url&&(n=e.artwork_url.replace("-large","-t500x500")),null!=e.playback_count&&(y=e.playback_count),null!=e.duration&&(c=e.duration/1e3),g={title:""+t.artist+"  —  "+t.title+" "+f,orig_title:e.title,song:t.title,artist:t.artist,rank:t.rank,korean:f,genre:s,tags:p,created:l,url:h,perma:d,artwork:n,duration:c,views:y,score:0,query:t.query},r=o(g,t.query),g.score=i(g,t.query),r===!0&&g.score>=2?u.push(g):void 0}),u.sort(function(t,e){var n;return n=e.score-t.score,0!==n?n:e.views-t.views}),u.length>0?e.resolve(u[0]):e.reject(),void 0)}),e.promise()},n=function(t){var e,n;e=m.length,n=19,null!=t.query&&m.unshift(t.query),e>n&&m.splice(n+1,e-n)},T=function(){var t;return t=N.filter(function(t){return m.indexOf(t.query)<0}),t=t.filter(function(t){return k.indexOf(t.query)<0}),t=t.filter(function(t){return s.indexOf(t.query)<0}),t[Math.floor(Math.random()*t.length)]},D=function(t){var e,r;return r=function(t){return h(t).done(function(t){return n(t),e.resolve(t)}).fail(function(){var e;return k.push(t),e=T(),r(e)})},e=$.Deferred(),r(t),e.promise()},d=function(){var t,e,n,r,o,i,u,a;return B=[_,O,S,C,A],e=B.indexOf(document.getElementsByClassName("active")[0]),n=B.length-1,t=null==e||e===n?0:e+1,r=t===n?0:t+1,o=r===n?0:r+1,u=o===n?0:o+1,i=u===n?0:u+1,a={active:B[t],next:B[r],onDeck:B[o],onDeckTwo:B[u],onDeckThree:B[i],last:B[e]}},u=function(){var t,e,n,r,o,i,u,a;return B=[_,O,S,C,A],e=B.indexOf(document.getElementsByClassName("active")[0]),n=B.length-1,t=null==e||e===n?0:e+1,r=t===n?0:t+1,o=r===n?0:r+1,u=o===n?0:o+1,i=u===n?0:u+1,a={active:B[t],next:B[r],onDeck:B[o],onDeckTwo:B[u],onDeckThree:B[i],last:B[e]},a.active.classList.add("active"),a.next.classList.remove("active"),a.onDeck.classList.remove("active"),a.onDeckTwo.classList.remove("active"),a.onDeckThree.classList.remove("active"),a},q=function(t,e){var n;return n=t.getElementsByTagName("SOURCE")[0],n.setAttribute("src",e.url),t.setAttribute("artwork",e.artwork),t.setAttribute("songtitle",e.title),t.setAttribute("songlength",e.duration),t.setAttribute("rank",e.rank),t.setAttribute("query",e.query),t.load()},y=function(t){var n,r,o,i,a,l,c,s;B=u(),l=B.active.getElementsByTagName("SOURCE")[0],i=T(),r=Number(B.active.getAttribute("songlength")).toHHMMSS(),n=B.active.getAttribute("artwork"),c=B.active.getAttribute("songtitle"),o=B.active.getAttribute("songlength"),s=l.getAttribute("src"),a=B.active.getAttribute("rank"),e(s,function(t){(404===t||503===t)&&y()}),e(n,function(t){(404===t||503===t)&&y()}),B.last.pause(),B.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=o&&void 0!==o&&$("#seek").attr("max",o),null!=c&&void 0!==c&&$("#title").text(c),null!=n&&void 0!==n&&$("#container").css("background","url("+n+") no-repeat center center"),$("#title").text(c),document.title=c,$("#rank").text("Rank "+a),$("#recentSongs").prepend("<li>"+B.last.getAttribute("songtitle")+"</li><button class='removeThumb'>&#xf00d;</button>"),t=B.active.getAttribute("query"),D(i).done(function(t){return q(B.last,t)})},H=0,Z=B.length;Z>H;H++)b=B[H],b.volume=.5,b.oncanplay=function(){var t,e;return t=this,e=1e3*(this.duration+30),setTimeout(function(){var e;t.paused&&(e=T(),D(e).done(function(e){return q(t,e)}))},e)},b.onerror=function(){return y()},b.onplaying=function(){return $("#playButton").html("&#xf04c;")},b.onended=function(){return y()},b.ontimeupdate=function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)};for($("#nextButton").on("click",function(){return y()}),$("#playButton").on("click",function(){var t;return t=document.getElementsByClassName("active")[0],t.paused?($("#playButton").html("&#xf04c;"),t.play()):($("#playButton").html("&#xf04b;"),t.pause())}),$("#seek").on("input",function(){var t;return t=document.getElementsByClassName("active")[0],t.pause(),t.currentTime=this.value}),$("#seek").on("change",function(){var t;return t=document.getElementsByClassName("active")[0],t.play()}),$("#volume").on("input change",function(){return _.volume=this.value,O.volume=this.value,S.volume=this.value,C.volume=this.value,A.volume=this.value}),$("#dontPlay").on("click",function(){var t,e,n;return t=document.getElementsByClassName("active")[0],e=t.getAttribute("query"),n=t.getAttribute("songtitle"),s.push(e),document.cookie="dontPlay="+JSON.stringify(s),$("#thumbsDownSongs").prepend("<li>"+n+"</li>"),y()}),$(".options").on("click",function(){return $(".options").toggleClass("activeOpts"),$(".options").toggleClass("rotate"),$("#optionsContainer").toggleClass("hideBottom"),$("#playerControls").toggleClass("hideBottom")}),$("#showOverlay").on("click",function(){var t;return $("#showOverlay").toggleClass("active"),t=$("#showOverlay").hasClass("active"),t===!0?($("#overlay").removeClass("hidden"),$("#container").addClass("hidden")):($("#overlay").addClass("hidden"),$("#container").removeClass("hidden")),t=$("#showOverlay").hasClass("active")}),z=0,I=s.length;I>z;z++)E=s[z],$("#thumbsDownSongs").prepend("<li>"+E+"</li>");for(R=0,J=N.length;J>R;R++)E=N[R],l=""+E.artist+" - "+E.title,$("#topList").append("<li class='topSong'>"+l+"</li>");$(document).ready(function(){var n,r,o,i,u;return o=T(),u=T(),i=T(),r=T(),n=T(),D(o).done(function(t){return q(_,t),e(t.url,function(t){(404===t||503===t)&&y()}),e(t.artwork,function(t){(404===t||503===t)&&y()}),null!=t.duration&&($("#endTime").val(t.duration.toHHMMSS()),$("#seek").attr("max",t.duration)),null!=t.artwork&&$("#container").css("background","url("+t.artwork+") no-repeat center center"),$("#title").text(t.title),$("#rank").text("Rank "+t.rank)}),D(u).done(function(t){return q(O,t)}),D(i).done(function(t){return q(S,t)}),D(r).done(function(t){return q(C,t)}),D(n).done(function(t){return q(A,t)}),$(".topSong").on("click",function(){var t,n,r,o;return n=this.innerHTML,t=n.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=$.grep(N,function(e){return e.query===t})[0],o=d(),D(r).done(function(t){e(t.url,function(){}),404!==status&&503!==status&&(q(o.active,t),y())})}),$.getJSON("http://graph.facebook.com/?id=http://www.jombly.com",function(e){$("#facebook-count").text(t(e.shares))}),$.getJSON("http://cdn.api.twitter.com/1/urls/count.json?url=http://www.jombly.com&callback=?",function(e){$("#twitter-count").text(t(e.count))})})}).call(this);
