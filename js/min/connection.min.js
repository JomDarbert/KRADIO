(function(){var e,t,n,r,a,o,i,s,u,l,c,d,h,g,v,f,m,p,y,k,C,w,x,b,A,T,_,B,O,F,D,E,M,q,L,S,N,H,j,z,I,Z,R,Y,J,P,U,X=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};for(s="2721807f620a4047d473472d46865f14",SC.initialize({client_id:s}),F=100,j=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],r=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat","short","club"],k=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,v=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,C=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,f=[],y=[],d=function(e){var t,n;return t=new RegExp(e+"=([^;]+)"),n=t.exec(document.cookie),null!=n?unescape(n[1]):null},g=function(){var e;return e=null,e=new XMLHttpRequest,e.open("GET","http://localhost:3000/today",!1),e.send(null),e.responseText},h=function(e){return $.post("http://localhost:3000/getSong",{query:e},function(e){return e})},H=function(e,t,n){return $.post("http://localhost:3000/vote",{query:e,tag:t},function(e){n.innerHTML=e[0][t]})},l=d("dontPlay"),c=null!==l?JSON.parse(l):[],A=document.getElementById("player_one"),_=document.getElementById("player_two"),T=document.getElementById("player_three"),b=document.getElementById("player_four"),x=document.getElementById("player_five"),B=[A,_,T,b,x],q=[],L=JSON.parse(g()),S=arrayUnique(L),S=S.filter(function(e){return c.indexOf(e.query)<0}),Number.prototype.toHHMMSS=function(){var e,t,n;return e=Math.floor(this/3600),t=Math.floor(this%3600/60),n=Math.floor(this%3600%60),(e>0?e+":":"")+(t>0?(e>0&&10>t?"0":"")+t+":":"0:")+(10>n?"0":"")+n},t=function(e,t){jQuery.ajax({url:e,dataType:"text",type:"GET",complete:function(e){"function"==typeof t&&t.apply(this,[e.status])}})},e=function(e){var t;return t=e.toString().split("."),t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},a=function(e,t){var n,a,o,i,s,u,l,c,d,h,g,v,f,m,p,$,y;if(null==e.orig_title)return!1;if(null==e.url)return!1;if(null==e.created)return!1;if(l=12,i=moment(e.created,"YYYY-MM-DD HH:MM:SS"),s=moment().subtract(l,"months"),s.diff(i,"months")>0)return!1;if(e.duration>360)return!1;for(v=0,p=r.length;p>v;v++)if(g=r[v],-1!==e.orig_title.indexOf(g))return!1;for(f=0,$=r.length;$>f;f++)if(g=r[f],null!=e.genre&&-1!==e.genre.indexOf(g))return!1;for(m=0,y=r.length;y>m;m++)if(g=r[m],X.call(e.tags,g)>=0)return!1;return u=k.test(e.orig_title),u===!0?!1:(o=e.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),a=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),h=o.split(" "),c=a.split(" "),n=[h,c],d=n.shift().reduce(function(e,t){return-1===e.indexOf(t)&&n.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),0===d.length?!1:levenstein(a,o)>=8?!1:!0)},o=function(e,t){var n,r,a,o,i,s,u,l,c,d,h,g,f,m;for(u=0,c=0,i=0,a=e.orig_title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),m=e.genre,X.call(j,m)>=0&&(u+=1),g=0,f=j.length;f>g;g++)d=j[g],X.call(e.tags,d)>=0&&(c+=1);return c>0&&(u+=1),h=v.test(e.orig_title),h===!0&&(u+=1),l=a.split(" "),o=r.split(" "),n=[l,o],s=n.shift().reduce(function(e,t){return-1===e.indexOf(t)&&n.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),s.length===o.length&&(u+=1),levenstein(r,a)<=5&&(u+=1),u},m=function(e){var t;return t=$.Deferred(),SC.get("/tracks",{q:e.query,limit:F},function(n,r){var i;return null==n||0===n.length||null!==r?void t.reject():(i=[],n.forEach(function(t){var n,r,u,l,c,d,h,g,f,m,p;return f=v.test(t.title),d=null!=t.title&&f===!0?"("+t.title.toLowerCase().replace(C,"")+")":"",null!=t.genre&&(c=t.genre.toLowerCase()),null!=t.tag_list&&(g=t.tag_list.toLowerCase().split(" ")),null!=t.created_at&&(u=t.created_at),null!=t.stream_url&&(m=t.stream_url+"?client_id="+s),null!=t.artwork_url&&(n=t.artwork_url.replace("-large","-t500x500")),null!=t.playback_count&&(p=t.playback_count),null!=t.duration&&(l=t.duration/1e3),h={title:""+e.artist+"  —  "+e.title+" "+d,orig_title:t.title,song:e.title,artist:e.artist,rank:e.rank,num_days:e.num_days,change:e.change,korean:d,genre:c,tags:g,created:u,url:m,artwork:n,duration:l,views:p,score:0,query:e.query},r=a(h,e.query),h.score=o(h,e.query),r===!0&&h.score>=2?i.push(h):void 0}),i.sort(function(e,t){var n;return n=t.score-e.score,0!==n?n:t.views-e.views}),i.length>0?t.resolve(i[0]):t.reject(),void 0)}),t.promise()},n=function(e){var t,n;t=f.length,n=19,null!=e.query&&f.unshift(e.query),t>n&&f.splice(n+1,t-n)},D=function(){var e;return e=S.filter(function(e){return f.indexOf(e.query)<0}),e=e.filter(function(e){return y.indexOf(e.query)<0}),e=e.filter(function(e){return c.indexOf(e.query)<0}),e[Math.floor(Math.random()*e.length)]},O=function(e){var t,r;return r=function(e){return m(e).done(function(e){return n(e),t.resolve(e)}).fail(function(){var t;return y.push(e),t=D(),r(t)})},t=$.Deferred(),r(e),t.promise()},i=function(){var e,t,n,r,a,o,i,s;return B=[A,_,T,b,x],t=B.indexOf(document.getElementsByClassName("active")[0]),n=B.length-1,e=null==t||t===n?0:t+1,r=e===n?0:e+1,a=r===n?0:r+1,i=a===n?0:a+1,o=i===n?0:i+1,s={active:B[e],next:B[r],onDeck:B[a],onDeckTwo:B[i],onDeckThree:B[o],last:B[t]},s.active.classList.add("active"),s.next.classList.remove("active"),s.onDeck.classList.remove("active"),s.onDeckTwo.classList.remove("active"),s.onDeckThree.classList.remove("active"),s},E=function(e,t){var n;return n=e.getElementsByTagName("SOURCE")[0],n.setAttribute("src",t.url),e.setAttribute("artwork",t.artwork),e.setAttribute("songtitle",t.title),e.setAttribute("songlength",t.duration),e.setAttribute("rank",t.rank),e.setAttribute("change",t.change),e.setAttribute("num_days",t.num_days),e.setAttribute("query",t.query),e.load()},N=function(e){return h(e).done(function(e){var t,n,r,a,o,i,s;for(n=document.getElementsByClassName("tagBtn"),s=[],o=0,i=n.length;i>o;o++)t=n[o],a=t.innerHTML.replace("amp;","").replace(/[^A-Za-z]/g,""),r=document.getElementById(a+"Label"),s.push(void 0!==e[0][a]?r.innerHTML=e[0][a]:r.innerHTML=0);return s})},p=function(){var e,n,r,a,o,s,u,l,c,d,h;B=i(),c=B.active.getElementsByTagName("SOURCE")[0],u=D(),r=Number(B.active.getAttribute("songlength")).toHHMMSS(),e=B.active.getAttribute("artwork"),d=B.active.getAttribute("songtitle"),a=B.active.getAttribute("songlength"),h=c.getAttribute("src"),l=B.active.getAttribute("rank"),n=B.active.getAttribute("change"),o=B.active.getAttribute("num_days"),t(h,function(e){(404===e||503===e)&&p()}),t(e,function(e){(404===e||503===e)&&p()}),B.last.pause(),B.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=a&&void 0!==a&&$("#seek").attr("max",a),null!=d&&void 0!==d&&$("#title").text(d),null!=e&&void 0!==e&&$("#container").css("background","url("+e+") no-repeat center center"),$("#title").text(d),document.title=d,$("#rank").text("Rank "+l),0>n&&($("#change").css("color","#D7431B"),$("#change").text("( "+n+" )")),n>0&&($("#change").css("color","#288668"),$("#change").text("( +"+n+" )")),0===n&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+o+" days on chart"),$("#recentSongs").prepend("<li>"+B.last.getAttribute("songtitle")+"</li><button class='removeThumb'>&#xf00d;</button>"),s=B.active.getAttribute("query"),N(s),O(u).done(function(e){return E(B.last,e)})},document.addEventListener("touchmove",function(e){return"INPUT"!==e.target.tagName?e.preventDefault():void 0}),z=void 0,I=0,document.addEventListener("touchstart",function(e){z=e.touches[0].screenX,I=e.touches[0].screenY}),document.addEventListener("touchmove",function(e){var t,n;t=Math.abs(e.touches[0].screenX-z),n=Math.abs(e.touches[0].screenY-I),3*n>t&&e.preventDefault()}),Z=0,J=B.length;J>Z;Z++)w=B[Z],w.volume=.5,w.oncanplay=function(){var e,t;return e=this,t=1e3*(this.duration+30),setTimeout(function(){var t;e.paused&&(t=D(),O(t).done(function(t){return E(e,t)}))},t)},w.onerror=function(){return p()},w.onplaying=function(){return $("#playButton").html("&#xf04c;")},w.onended=function(){return p()},w.ontimeupdate=function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)};for($("#tags button").on("click",function(){var e,t,n,r,a,o,i,s,u;for(r=document.getElementsByClassName("active")[0],a=r.getAttribute("query"),i=this.innerHTML.replace("amp;","").replace(/[^A-Za-z]/g,""),n=document.getElementById(i+"Label"),e=0,t=s=0,u=q.length;u>s;t=++s)o=q[t],o.query===a&&(e++,q[t].tags.indexOf(i)<0&&(H(a,i,n),q[t].tags.push(i)));return 0===e?(q.push({query:a,tags:[i]}),H(a,i,n)):void 0}),$("#nextButton").on("click",function(){return p()}),$("#playButton").on("click",function(){var e;return e=document.getElementsByClassName("active")[0],e.paused?($("#playButton").html("&#xf04c;"),e.play()):($("#playButton").html("&#xf04b;"),e.pause())}),$("#seek").on("input",function(){var e;return e=document.getElementsByClassName("active")[0],e.pause(),e.currentTime=this.value}),$("#seek").on("change",function(){var e;return e=document.getElementsByClassName("active")[0],e.play()}),$("#volume").on("input change",function(){return A.volume=this.value,_.volume=this.value,T.volume=this.value,b.volume=this.value,x.volume=this.value}),$("#dontPlay").on("click",function(){var e,t,n;return e=document.getElementsByClassName("active")[0],t=e.getAttribute("query"),n=e.getAttribute("songtitle"),c.push(t),document.cookie="dontPlay="+JSON.stringify(c),$("#thumbsDownSongs").prepend("<li>"+n+"</li>"),p()}),$(".options").on("click",function(){return $(".options").toggleClass("activeOpts"),$(".options").toggleClass("rotate"),$("#optionsContainer").toggleClass("hideBottom"),$("#playerControls").toggleClass("hideBottom")}),$("#showOverlay").on("click",function(){var e,t,n;return $("#showOverlay").toggleClass("active"),$("#showTags, #showFilters").removeClass("active"),t=$("#showOverlay").hasClass("active"),n=$("#showTags").hasClass("active"),e=$("#showFilters").hasClass("active"),t===!0?($("#overlay").removeClass("hidden"),$("#container").addClass("hidden"),$("#tags").addClass("hidden"),$("#filters").addClass("hidden")):($("#overlay").addClass("hidden"),$("#container").removeClass("hidden"))}),$("#showTags").on("click",function(){var e,t,n;return $("#showTags").toggleClass("active"),$("#showOverlay, #showFilters").removeClass("active"),t=$("#showOverlay").hasClass("active"),n=$("#showTags").hasClass("active"),e=$("#showFilters").hasClass("active"),n===!0?($("#overlay").addClass("hidden"),$("#container").addClass("hidden"),$("#tags").removeClass("hidden"),$("#filters").addClass("hidden")):($("#tags").addClass("hidden"),$("#container").removeClass("hidden"))}),$("#showFilters").on("click",function(){var e,t,n;return $("#showFilters").toggleClass("active"),$("#showTags, #showOverlay").removeClass("active"),t=$("#showOverlay").hasClass("active"),n=$("#showTags").hasClass("active"),e=$("#showFilters").hasClass("active"),e===!0?($("#overlay").addClass("hidden"),$("#container").addClass("hidden"),$("#tags").addClass("hidden"),$("#filters").removeClass("hidden")):($("#filters").addClass("hidden"),$("#container").removeClass("hidden"))}),R=0,P=c.length;P>R;R++)M=c[R],$("#thumbsDownSongs").prepend("<li>"+M+"</li>");for(Y=0,U=S.length;U>Y;Y++)M=S[Y],u=""+M.artist+" - "+M.title,$("#topList").append("<li>"+u+"</li>");$("#reddit-count").on("change",function(){var e;return e=$("#reddit-count").text(),$("#reddit-count").text(e.replace(/[^0-9]/g,""))}),$(document).ready(function(){var n,r,a,o,i;return a=D(),i=D(),o=D(),r=D(),n=D(),O(a).done(function(e){return E(A,e),N(a.query),t(e.url,function(e){(404===e||503===e)&&p()}),t(e.artwork,function(e){(404===e||503===e)&&p()}),null!=e.duration&&($("#endTime").val(e.duration.toHHMMSS()),$("#seek").attr("max",e.duration)),null!=e.artwork&&$("#container").css("background","url("+e.artwork+") no-repeat center center"),$("#title").text(e.title),$("#rank").text("Rank "+e.rank),e.change<0&&($("#change").css("color","#D7431B"),$("#change").text("( "+e.change+" )")),e.change>0&&($("#change").css("color","#288668"),$("#change").text("( +"+e.change+" )")),0===e.change&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+e.num_days+" days on chart")}),O(i).done(function(e){return E(_,e)}),O(o).done(function(e){return E(T,e)}),O(r).done(function(e){return E(b,e)}),O(n).done(function(e){return E(x,e)}),$.getJSON("http://graph.facebook.com/?id=http://www.jombly.com",function(t){$("#facebook-count").text(e(t.shares))}),$.getJSON("http://cdn.api.twitter.com/1/urls/count.json?url=http://www.jombly.com&callback=?",function(t){$("#twitter-count").text(e(t.count))}),reddit.info().url("jombly.com").fetch(function(e){var t,n,r,a,o;for(n=0,o=e.data.children,r=0,a=o.length;a>r;r++)t=o[r],n+=t.data.score;return $("#reddit-count").text(n)})})}).call(this);
