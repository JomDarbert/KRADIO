(function(){var t,e,n,r,a,u,i,o,l,s,c,g,d,f,h,m,v,p,y,k,A,b,x,w,_,F,q,C,B,D=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};for(i="2721807f620a4047d473472d46865f14",SC.initialize({client_id:i}),x=100,q=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],n=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat"],h=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,s=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,m=/[^\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,c=[],f=[],o=[],p=document.getElementById("player_one"),k=document.getElementById("player_two"),y=document.getElementById("player_three"),A=[p,k,y],l=function(){var t;return t=null,t=new XMLHttpRequest,t.open("GET","http://jombly.com:3000/today",!1),t.send(null),t.responseText},_=JSON.parse(l()),F=arrayUnique(_),Number.prototype.toHHMMSS=function(){var t,e,n;return t=Math.floor(this/3600),e=Math.floor(this%3600/60),n=Math.floor(this%3600%60),(t>0?t+":":"")+(e>0?(t>0&&10>e?"0":"")+e+":":"0:")+(10>n?"0":"")+n},t=function(t,e){jQuery.ajax({url:t,dataType:"text",type:"GET",complete:function(t){"function"==typeof e&&e.apply(this,[t.status])}})},r=function(t,e){var r,a,u,i,o,l,s,c,g,d,f,m,v,p,y,k,A;if(null==t.title)return!1;if(null==t.url)return!1;if(null==t.created)return!1;if(s=12,i=moment(t.created,"YYYY-MM-DD HH:MM:SS"),o=moment().subtract(s,"months"),o.diff(i,"months")>0)return!1;if(t.duration>360)return!1;for(m=0,y=n.length;y>m;m++)if(f=n[m],-1!==t.title.indexOf(f))return!1;for(v=0,k=n.length;k>v;v++)if(f=n[v],null!=t.genre&&-1!==t.genre.indexOf(f))return!1;for(p=0,A=n.length;A>p;p++)if(f=n[p],D.call(t.tags,f)>=0)return!1;return l=h.test(t.title),l===!0?!1:(u=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),a=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),d=u.split(" "),c=a.split(" "),r=[d,c],g=r.shift().reduce(function(t,e){return-1===t.indexOf(e)&&r.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),0===g.length?!1:!0)},a=function(t,e){var n,r,a,u,i,o,l,c,g,d,f,h,m,v;for(l=0,g=0,i=0,a=t.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),r=e.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),v=t.genre,D.call(q,v)>=0&&(l+=1),h=0,m=q.length;m>h;h++)d=q[h],D.call(t.tags,d)>=0&&(g+=1);return g>0&&(l+=1),f=s.test(t.title),f===!0&&(l+=1),c=a.split(" "),u=r.split(" "),n=[c,u],o=n.shift().reduce(function(t,e){return-1===t.indexOf(e)&&n.every(function(t){return-1!==t.indexOf(e)})&&t.push(e),t},[]),o.length===u.length&&(l+=1),levenstein(r,a)<=10&&(l+=1),l},g=function(t){var e;return e=$.Deferred(),SC.get("/tracks",{q:t.query,limit:x},function(n,u){var o;return null==n||0===n.length||null!==u?void e.reject():(o=[],n.forEach(function(e){var n,u,l,c,g,d,f,h,v,p,y;return v=s.test(e.title),d=null!=e.title&&v===!0?"("+e.title.toLowerCase().replace(m,"")+")":"",null!=e.genre&&(g=e.genre.toLowerCase()),null!=e.tag_list&&(h=e.tag_list.toLowerCase().split(" ")),null!=e.created_at&&(l=e.created_at),null!=e.stream_url&&(p=e.stream_url+"?client_id="+i),null!=e.artwork_url&&(n=e.artwork_url.replace("-large","-t500x500")),null!=e.playback_count&&(y=e.playback_count),null!=e.duration&&(c=e.duration/1e3),f={title:""+t.artist+"  —  "+t.title+" "+d,song:t.title,artist:t.artist,rank:t.rank,num_days:t.num_days,change:t.change,korean:d,genre:g,tags:h,created:l,url:p,artwork:n,duration:c,views:y,score:0,query:t.query},u=r(f,t.query),f.score=a(f,t.query),u===!0&&f.score>=3?o.push(f):void 0}),o.sort(function(t,e){return e.views-t.views}),o.length>0?e.resolve(o[0]):e.reject(),void 0)}),e.promise()},e=function(t){var e,n;e=c.length,n=9,null!=t.query&&c.unshift(t.query),e>n&&c.splice(n+1,e-n)},w=function(){var t;return t=F.filter(function(t){return c.indexOf(t)<0}),t=t.filter(function(t){return f.indexOf(t)<0}),t=t.filter(function(t){return o.indexOf(t)<0}),t[Math.floor(Math.random()*t.length)]},b=function(t){var n,r;return r=function(t){return g(t).done(function(t){return e(t),n.resolve(t)}).fail(function(){var e;return f.push(t),e=w(),r(e)})},n=$.Deferred(),r(t),n.promise()},u=function(){var t,e,n,r,a,u;return A=[p,k,y],e=A.indexOf(document.getElementsByClassName("active")[0]),n=A.length-1,t=null==e||e===n?0:e+1,r=t===n?0:t+1,a=r===n?0:r+1,u={active:A[t],next:A[r],onDeck:A[a],last:A[e]},u.active.classList.add("active"),u.next.classList.remove("active"),u.onDeck.classList.remove("active"),u},d=function(){var e,n,r,a,i,o,l,s,c;A=u(),o=w(),r=Number(A.active.getAttribute("songlength")).toHHMMSS(),e=A.active.getAttribute("artwork"),s=A.active.getAttribute("songtitle"),a=A.active.getAttribute("songlength"),c=A.active.getAttribute("src"),l=A.active.getAttribute("rank"),n=A.active.getAttribute("change"),i=A.active.getAttribute("num_days"),t(c,function(t){(404===t||503===t)&&d()}),t(e,function(t){(404===t||503===t)&&d()}),A.last.pause(),A.active.play(),null!=r&&void 0!==r&&$("#endTime").val(r),null!=a&&void 0!==a&&$("#seek").attr("max",a),null!=s&&void 0!==s&&$("#title").text(s),null!=e&&void 0!==e&&$("#container").css("background","url("+e+") no-repeat center center"),$("#title").text(s),$("#rank").text("Rank "+l),0>n&&($("#change").css("color","#D7431B"),$("#change").text("( "+n+" )")),n>0&&($("#change").css("color","#288668"),$("#change").text("( +"+n+" )")),0===n&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+i+" days on chart"),b(o).done(function(t){return A.last.setAttribute("src",t.url),A.last.setAttribute("artwork",t.artwork),A.last.setAttribute("songtitle",t.title),A.last.setAttribute("songlength",t.duration),A.last.setAttribute("rank",t.rank),A.last.setAttribute("change",t.change),A.last.setAttribute("num_days",t.num_days),A.last.setAttribute("query",t.query)})},document.addEventListener("touchmove",function(t){return t.preventDefault()}),$("#nextButton").on("click",function(){return d()}),$("#playButton").on("click",function(){var t;return t=document.getElementsByClassName("active")[0],t.paused?($("#playButton").html("&#xf04c;"),t.play()):($("#playButton").html("&#xf04b;"),t.pause())}),C=0,B=A.length;B>C;C++)v=A[C],$(v).on("playing",function(){return $("#playButton").html("&#xf04c;")}),$(v).on("ended",function(){return d()}),$(v).on("timeupdate",function(){return $("#currentTime").val(this.currentTime.toHHMMSS()),$("#seek").val(this.currentTime)});$("#seek").on("input",function(){var t;return t=document.getElementsByClassName("active")[0],t.pause(),t.currentTime=this.value}),$("#seek").on("change",function(){var t;return t=document.getElementsByClassName("active")[0],t.play()}),$("#dontPlay").on("click",function(){var t,e;return t=document.getElementsByClassName("active")[0],e=t.getAttribute("query"),o.push(e),d(),console.log(o)}),$(document).ready(function(){var t,e,n;return t=w(),n=w(),e=w(),b(t).done(function(t){return p.setAttribute("src",t.url),p.setAttribute("artwork",t.artwork),p.setAttribute("songtitle",t.title),p.setAttribute("songlength",t.duration),p.setAttribute("rank",t.rank),p.setAttribute("change",t.change),p.setAttribute("num_days",t.num_days),p.setAttribute("query",t.query),null!=t.duration&&($("#endTime").val(t.duration.toHHMMSS()),$("#seek").attr("max",t.duration)),null!=t.artwork&&$("#container").css("background","url("+t.artwork+") no-repeat center center"),$("#title").text(t.title),$("#rank").text("Rank "+t.rank),t.change<0&&($("#change").css("color","#D7431B"),$("#change").text("( "+t.change+" )")),t.change>0&&($("#change").css("color","#288668"),$("#change").text("( +"+t.change+" )")),0===t.change&&($("#change").css("color","#2d3033"),$("#change").text("( — )")),$("#daysOnChart").text(""+t.num_days+" days on chart")}),b(n).done(function(t){return k.setAttribute("src",t.url),k.setAttribute("artwork",t.artwork),k.setAttribute("songtitle",t.title),k.setAttribute("songlength",t.duration),k.setAttribute("rank",t.rank),k.setAttribute("change",t.change),k.setAttribute("num_days",t.num_days),k.setAttribute("query",t.query)}),b(e).done(function(t){return y.setAttribute("src",t.url),y.setAttribute("artwork",t.artwork),y.setAttribute("songtitle",t.title),y.setAttribute("songlength",t.duration),y.setAttribute("rank",t.rank),y.setAttribute("change",t.change),y.setAttribute("num_days",t.num_days),y.setAttribute("query",t.query)})})}).call(this);
