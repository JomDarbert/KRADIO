(function(){var e,t,r,n,a,i,u,l,o,s,c,f,d,p,g,v,m,h,k,y,w,x,A,_=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};for(i="2721807f620a4047d473472d46865f14",SC.initialize({client_id:i}),m=100,w=["kpop","k pop","k-pop","korean","korea","kor","kor pop","korean pop","korean-pop","kor-pop","korean version","kr","kr ver","original"],t=["cover","acoustic","instrumental","remix","mix","re mix","re-mix","version","ver.","live","live cover","accapella","cvr","united states","america","india","indian","japan","china","chinese","japanese","viet","vietnam","vietnamese","thai","taiwan","taiwanese","russian","ambient","meditat"],f=/[^A-Za-z0-9\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF \♡\.\「\」\”\“\’\∞\♥\|\【\】\–\{\}\[\]\!\@\#\$\%\^\&\*\(\)\-\_\=\+\;\:\'\"\,\.\<\>\/\\\?\`\~]/g,u=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,l=[],c=[],d=document.getElementById("player_one"),g=document.getElementById("player_two"),p=document.getElementById("player_three"),o=function(){var e;return e=null,$.ajax({async:!1,global:!1,url:"../scrape/songs.json",dataType:"json",success:function(t){e=t}}),e}(),y=[],x=0,A=o.length;A>x;x++)k=o[x],y.push(k.query);y=arrayUnique(y),r=function(e,r){var n,a,i,u,l,o,s,c,d,p,g,v,m,h,k,y,w;if(null==e.title)return!1;if(null==e.url)return!1;if(null==e.created)return!1;if(s=12,u=moment(e.created,"YYYY-MM-DD HH:MM:SS"),l=moment().subtract(s,"months"),l.diff(u,"months")>0)return!1;for(v=0,k=t.length;k>v;v++)if(g=t[v],-1!==e.title.indexOf(g))return!1;for(m=0,y=t.length;y>m;m++)if(g=t[m],null!=e.genre&&-1!==e.genre.indexOf(g))return!1;for(h=0,w=t.length;w>h;h++)if(g=t[h],_.call(e.tags,g)>=0)return!1;return o=f.test(e.title),o===!0?!1:(i=e.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),a=r.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),p=i.split(" "),c=a.split(" "),n=[p,c],d=n.shift().reduce(function(e,t){return-1===e.indexOf(t)&&n.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),0===d.length?!1:!0)},n=function(e,t){var r,n,a,i,l,o,s,c,f,d,p,g,v,m;for(s=0,f=0,l=0,a=e.title.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),n=t.replace(/[^A-Za-z0-9\s]+/g,"").replace(/\s+/g," ").toLowerCase().trim(),m=e.genre,_.call(w,m)>=0&&(s+=1),g=0,v=w.length;v>g;g++)d=w[g],_.call(e.tags,d)>=0&&(f+=1);return f>0&&(s+=1),p=u.test(e.title),p===!0&&(s+=1),c=a.split(" "),i=n.split(" "),r=[c,i],o=r.shift().reduce(function(e,t){return-1===e.indexOf(t)&&r.every(function(e){return-1!==e.indexOf(t)})&&e.push(t),e},[]),o.length===i.length&&(s+=1),levenstein(n,a)<=10&&(s+=1),s},s=function(e){var t;return t=$.Deferred(),console.log("Starting get at: "+new Date),SC.get("/tracks",{q:e,limit:m},function(a){var u;return console.log("Got tracks at: "+new Date),null==a||0===a.length?(t.reject(),void 0):(u=[],a.forEach(function(t){var a,l,o,s,c,f,d,p,g;return null!=t.title&&(d=t.title.toLowerCase()),null!=t.genre&&(c=t.genre.toLowerCase()),null!=t.tag_list&&(f=t.tag_list.toLowerCase().split(" ")),null!=t.created_at&&(o=t.created_at),null!=t.stream_url&&(p=t.stream_url+"?client_id="+i),null!=t.artwork_url&&(a=t.artwork_url.replace("-large","-t500x500")),null!=t.playback_count&&(g=t.playback_count),null!=t.duration&&(s=t.duration/1e3),k={title:d,genre:c,tags:f,created:o,url:p,artwork:a,duration:s,views:g,score:0,query:e},l=r(k,e),k.score=n(k,e),l===!0&&k.score>=2?u.push(k):void 0}),u.sort(function(e,t){var r;return r=t.score-e.score,0!==r?r:t.views-e.views}),u.length>0?t.resolve(u[0]):t.reject(),void 0)}),t.promise()},e=function(e){var t,r;t=l.length,r=9,null!=e.query&&l.unshift(e.query),t>r&&l.splice(r+1,t-r)},h=function(){var e;return e=y.filter(function(e){return l.indexOf(e)<0}),e=e.filter(function(e){return c.indexOf(e)<0}),e[Math.floor(Math.random()*e.length)]},v=function(t){var r,n;return n=function(t){return s(t).done(function(t){return e(t),r.resolve(t)}).fail(function(){var e;return c.push(t),e=h(),n(e)})},r=$.Deferred(),n(t),r.promise()},a=function(){var e,t,r,n,a,i,u;return i=[d,g,p],t=i.indexOf(document.getElementsByClassName("active")[0]),r=i.length-1,e=null==t||t===r?0:t+1,n=e===r?0:e+1,a=n===r?0:n+1,u={active:i[e],next:i[n],onDeck:i[a],last:i[t]},u.active.classList.add("active"),u.next.classList.remove("active"),u.onDeck.classList.remove("active"),u},$("#nextButton").on("click",function(){var e,t;return e=a(),t=h(),e.last.pause(),e.active.play(),v(t).done(function(t){return console.log("Got "+t.title+" at: "+new Date),e.last.setAttribute("src",t.url)})}),$("#playButton").on("click",function(){var e;return e=document.getElementsByClassName("active")[0],e.paused?e.play():e.pause()}),$(document).ready(function(){var e,t,r;return e=h(),r=h(),t=h(),v(e).done(function(e){return d.setAttribute("src",e.url)}),v(r).done(function(e){return g.setAttribute("src",e.url)}),v(t).done(function(e){return p.setAttribute("src",e.url)})})}).call(this);